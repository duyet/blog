{"componentChunkName":"component---src-templates-post-template-tsx","path":"/2021/11/rust-data-engineering.html","result":{"data":{"markdownRemark":{"id":"9e469cc5-35e8-553c-a21f-9251ed088746","html":"<p>Rust mà một trong những ngôn ngữ có tốc độ phát triển nhanh nhất,\nđược xếp hạng vào một trong những ngôn ngữ được yêu thích nhất trong\nnhiều năm theo <a href=\"https://insights.stackoverflow.com/survey/2021#most-loved-dreaded-and-wanted-language-love-dread\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">StackOverflow Survey</a>.</p>\n<p><figure class=\"md-figure\"><img src=\"https://1.bp.blogspot.com/-vMsrOjluhsk/YaEajTOjloI/AAAAAAACXhA/jPU7jYzICwgqE9pju-oDp0uFQLIzOsnqwCLcBGAsYHQ/s0/stackoverflow-surveys.png\"><figcaption>For the sixth-year, Rust is the most loved language, while Python is the most wanted language for its fifth-year.</figcaption></figure></p>\n<p>Là một Data Engineer (DE) thì mình sử dụng Python (và Typescript) như ngôn ngữ chính mỗi ngày như mọi DE khác.\nTuy nhiên mình luôn muốn tìm hiểu một ngôn ngữ khác, bởi</p>\n<ul>\n<li>Để hiểu thêm về cách sử dụng một ngôn ngữ low-level và high performance, cái mà Python đã khiến mình lãng quên từ lâu.</li>\n<li>Python không tốt với nhu cầu của mình trong một số trường hợp (build tool, build CLI, quản lý dependency mệt mỏi, không kiểm soát được các edge-case, …)</li>\n</ul>\n<p>Mình đã phải cân nhắc giữa <a href=\"https://bitfieldconsulting.com/golang/rust-vs-go\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Golang và Rust</a> trong một thời gian dài.\nBởi vì, Fossil sử dụng Golang cho các Microservices, performance thật sự rất tốt.\nRust cũng tương tự, rất thường được hay <a href=\"https://bitfieldconsulting.com/golang/rust-vs-go\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">so sánh với Golang</a>.\nĐây cũng là hai ngôn ngữ có cú pháp gần với C++, có hiệu năng tốt tương đương về mặt performance, mình đã từng xem\nrất nhiều chục bài viết về benchmark.\nCác ngôn ngữ này còn giải quyết về vấn đề code safety và các công cụ đủ tốt,\nstandard và đơn giản cho việc development (ví dụ như <code class=\"language-text\">go fmt</code>, <code class=\"language-text\">cargo fmt</code>, <code class=\"language-text\">cargo test</code>, …)</p>\n<h1 id=\"why-rust\" style=\"position:relative;\"><a href=\"#why-rust\" aria-label=\"why rust permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why Rust?</h1>\n<p>Đối với mình, mình ưu tiên chọn dựa trên việc nó có giải quyết được hết hầu hết các nhu cầu và bài toán của mình hay không:\nData Engineering, Distributed System và Web Development.</p>\n<p>Và cuối cùng mình dự định sẽ bắt đầu với Rust, bởi vì</p>\n<ul>\n<li>Rust có thể làm việc với OS System, Networking và Embedding. Được tạo bởi Mozilla, Rust hiện đang được dùng ở  <strong><a href=\"https://engineering.fb.com/2021/04/29/developer-tools/rust/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Facebook</a></strong>, <strong><a href=\"https://twitter.com/oskargroth/status/1301502690409709568\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Apple</a></strong>, <strong><a href=\"https://aws.amazon.com/blogs/opensource/why-aws-loves-rust-and-how-wed-like-to-help/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Amazon</a></strong>, <strong><a href=\"https://twitter.com/ryan_levick/status/1171830191804551168\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Microsoft</a></strong>, và <strong><a href=\"https://security.googleblog.com/2021/04/rust-in-android-platform.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Google</a></strong> cho các dự án systems infrastructure, encryption và virtualization. Một số dự án nổi bật như: <strong><a href=\"https://github.com/firecracker-microvm/firecracker\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Firecracker</a></strong> (AWS), <strong><a href=\"https://github.com/bottlerocket-os/bottlerocket\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Bottlerocket</a></strong> (AWS), <strong><a href=\"https://github.com/cloudflare/quiche\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Quiche</a></strong> (Cloudflare) và <strong><a href=\"https://github.com/mozilla/neqo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Neqo</a></strong> (Mozilla).</li>\n<li>Rust for the Web: <strong><a href=\"https://webassembly.org/docs/use-cases/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">WebAssembly</a></strong> <em>(WASM)</em>: mình còn làm việc với TypeScript và React để xây dựng các Web Tool, WASM là một xu hướng hiện nay, nhiều NPM package đang dần được viết bằng Rust và có thể chạy được trên frontend. Rust cũng đang dần thay thế nhiều thành phần trong hệ sinh thái của Javascript như minification (Terser), transpilation (Babel), formatting (Prettier), bundling (webpack), linting (ESLint).\n<ul>\n<li><strong><a href=\"http://swc.rs/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SWC</a></strong> viết bằng Rust, nó là một compilation, minification và bundling cho Typescript. SWC được dùng ở nhiều tools như Next.js, Parcel, và Deno.</li>\n<li><strong><a href=\"https://deno.land/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Deno</a></strong> là một JavaScript và TypeScript runtime viết bằng Rust bởi chính tác giả của Node.js</li>\n</ul>\n</li>\n<li>Viết code trên Rust an toàn, hầu hết các lỗi đều được complier phát hiện và giải thích rõ ràng.</li>\n<li>Nhiều project liên quan đến lĩnh vực Data cũng được viết bằng Rust hoặc hỗ trợ Rust (Thrift Rust, Kafka Client Rust, Apache Arrow, …)</li>\n</ul>\n<p>Mình cũng được truyền cảm hứng nhiều từ nhiều bài viết về Rust, một trong số chúng là: <strong><a href=\"https://andygrove.io/2018/01/rust-is-for-big-data/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Rust is for Big Data (#rust2018)</a>. Andy</strong> là tác giả của project Apache Arrow DataFusion và Ballista query engines. Ông giả thuyết rằng nếu Apache Spark được viết lại bằng Rust từ đầu, thì hiệu năng chắc hẳn sẽ tốt hơn, quan trọng nhất là nó có thể <em>predictable</em> và <em>reliable.</em> Mình có cùng quan điểm khi Spark hay bị vấn đề OutOfMemory của JVM.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> ctx <span class=\"token operator\">=</span> <span class=\"token class-name\">ExecutionContext</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">register_csv</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"example\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"tests/example.csv\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CsvReadOptions</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">await</span><span class=\"token operator\">?</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// create a plan</span>\n<span class=\"token keyword\">let</span> df <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">sql</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SELECT a, MIN(b) FROM example GROUP BY a LIMIT 100\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">await</span><span class=\"token operator\">?</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// execute the plan</span>\n<span class=\"token keyword\">let</span> results<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vec</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">RecordBatch</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> df<span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">await</span><span class=\"token operator\">?</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// format the results</span>\n<span class=\"token keyword\">let</span> pretty_results <span class=\"token operator\">=</span> <span class=\"token namespace\">arrow<span class=\"token punctuation\">::</span>util<span class=\"token punctuation\">::</span>pretty<span class=\"token punctuation\">::</span></span><span class=\"token function\">pretty_format_batches</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>results<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> expected <span class=\"token operator\">=</span> <span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"+---+----------------+\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"| a | MIN(example.b) |\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"+---+----------------+\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"| 1 | 2              |\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"+---+----------------+\"</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\">assert_eq!</span><span class=\"token punctuation\">(</span>pretty_results<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">lines</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">::</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">Vec</span><span class=\"token operator\">&lt;</span>_<span class=\"token operator\">>></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> expected<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1 id=\"difficult-rust\" style=\"position:relative;\"><a href=\"#difficult-rust\" aria-label=\"difficult rust permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Difficult Rust</h1>\n<p>Mặc dù Rust là một ngôn ngữ được yêu thích, tuy nhiên mình cảm nhận nó có syntax khác là\nkhó và steep learning curve, có nghĩa là khó có thể nắm bắt được trong thời gian ngắn.\nDễ hiểu vì sao Rust vẫn chưa lọt vào top 10 ngôn ngữ phổ biến.</p>\n<p>Rust được thiết kế để giải quyết vài vấn đề rất khó trong lập trình bởi vì\nconcept khác biệt và giải quyết chúng cũng bằng một cách rất khác.</p>\n<p>Rust tương đối mới nên có số lượng libraries ít hơn đáng kể so với Python.\nVì thế nếu sử dụng ta phải viết lại 1 lượng lớn codebases from scratch.\nCho nên đối với lập trình viên có ít background về low-level programming, sử dụng Rust là một thử thách.</p>\n<p>Mình nghĩ, mặc dù đã có nhiều bài viết về việc các data engineer và\n<a href=\"https://www.nature.com/articles/d41586-020-03382-2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">data scientist</a> đang dần\nchú ý tới Rust, nhưng vẫn rất khó để Rust có thể thay thế được Python.</p>\n<h1 id=\"rust-tools-và-frameworks-cho-big-data-và-parallel-processing\" style=\"position:relative;\"><a href=\"#rust-tools-v%C3%A0-frameworks-cho-big-data-v%C3%A0-parallel-processing\" aria-label=\"rust tools và frameworks cho big data và parallel processing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rust Tools và Frameworks cho Big Data và Parallel Processing</h1>\n<p>Mặc dù có ít thư viện, Rust vẫn có nhiều crate và tool để giải quyết các vấn đề cơ bản và phổ biến:</p>\n<ul>\n<li><code class=\"language-text\">serde</code>: là một crate giúp serialization và de-serialization Rust structures</li>\n<li><code class=\"language-text\">rayon</code>: program parallel computations, perform sequential calculations, provide a data-race free solution.</li>\n<li><code class=\"language-text\">tokio</code> là một event-driven, non-blocking I/O platform để viết các ứng dụng network asynchronous trên Rust. Tham khảo: <a href=\"https://tokio.rs/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://tokio.rs</a></li>\n<li><code class=\"language-text\">diese</code>: safe, extensible ORM and Query Builder. Tham khảo: <a href=\"https://diesel.rs/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://diesel.rs</a></li>\n<li><code class=\"language-text\">DataFusion</code> extensible query execution framework, sử dụng <a href=\"https://arrow.apache.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Apache Arrow</a> như là một in-memory format. DataFusion hỗ trợ cả SQL và DataFrame API để build logical query plans cũng như là query optimizer, parallel execution dựa trên partitioned data sources (CSV and Parquet). Tham khảo: <a href=\"https://github.com/apache/arrow-datafusion\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/apache/arrow-datafusion</a></li>\n<li><code class=\"language-text\">Ballista</code> theo mình tìm hiểu sơ là một Distributed Scheduler cho Apache Arrow và DataFusion. Chạy được trên Docker và Kubernetes như một Ballista cluster.</li>\n<li><a href=\"https://github.com/TimelyDataflow/timely-dataflow\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Timely dataflow</a>: low-latency cyclic dataflow computational model, được giới thiệu trong paper <a href=\"http://dl.acm.org/citation.cfm?id=2522738\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Naiad: a timely dataflow system</a>. Project này mục đích để xây dựng một distributed data-parallel compute engine, có thể scale 1 chương trình từ single thread trên laptop cho đến phân tán trên một cụm rất lớn gồm nhiều máy tính.</li>\n</ul>\n<h1 id=\"references\" style=\"position:relative;\"><a href=\"#references\" aria-label=\"references permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h1>\n<ul>\n<li>StackOverflow: <a href=\"https://insights.stackoverflow.com/survey/2021#technology-most-loved-dreaded-and-wanted\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Most loved, dreaded, and wanted</a></li>\n<li><a href=\"https://leerob.io/blog/rust\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Rust Is The Future of JavaScript Infrastructure</a></li>\n<li><a href=\"https://bitfieldconsulting.com/golang/rust-vs-go\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Rust vs Go</a></li>\n<li><a href=\"https://www.ritchievink.com/blog/2021/02/28/i-wrote-one-of-the-fastest-dataframe-libraries/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">I wrote one of the fastest DataFrame libraries</a></li>\n<li><a href=\"https://www.nature.com/articles/d41586-020-03382-2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Why scientists are turning to Rust</a></li>\n<li><a href=\"https://andygrove.io/2018/01/rust-is-for-big-data/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Rust is for Big Data (#rust2018)</a></li>\n</ul>","fields":{"slug":"/2021/11/rust-data-engineering.html","tagSlugs":["/tag/data-engineer/","/tag/rust/"]},"frontmatter":{"date":"2021-11-27T00:00:00.000+07:00","description":"Đối với một Data Engineer như mình, ưu tiên chọn một ngôn ngữ dựa trên việc nó có giải quyết được hết hầu hết các nhu cầu và bài toán của mình hay không: Data Engineering, Distributed System và Web Development. Và cuối cùng mình dự định sẽ bắt đầu với Rust, bởi vì ...\n","tags":["Data Engineer","Rust"],"title":"Rust và Data Engineering? 🤔","fbCommentUrl":"none"}}},"pageContext":{"slug":"/2021/11/rust-data-engineering.html"}},"staticQueryHashes":["251939775","2672868365","401334301"]}