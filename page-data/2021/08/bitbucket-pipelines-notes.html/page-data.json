{"componentChunkName":"component---src-templates-post-template-tsx","path":"/2021/08/bitbucket-pipelines-notes.html","result":{"data":{"markdownRemark":{"id":"bbd6ee27-785d-59b8-ab7a-4096f1951d19","html":"<p>Bitbucket Pipelines document is fragmented everywhere. It always makes me search for a while every time I write a new one for CI/CD. So Iâ€™ll make a few notes here.</p>\n<h1 id=\"tips-and-tricks\" style=\"position:relative;\"><a href=\"#tips-and-tricks\" aria-label=\"tips and tricks permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tips and tricks</h1>\n<h2 id=\"bitbucket-validator-tool\" style=\"position:relative;\"><a href=\"#bitbucket-validator-tool\" aria-label=\"bitbucket validator tool permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bitbucket Validator Tool</h2>\n<p>You can validate the bitbucket-pipelines.yml YAML format by using this tool:\n<a href=\"https://bitbucket-pipelines.atlassian.io/validator\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://bitbucket-pipelines.atlassian.io/validator</a></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/13df702cc93665566d7da5aa292c848f/3984b/bp.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACSklEQVQoz3WSy27TQBSGTZtLBftskBAskHgINl31BQKsqBewYhGkIsGyLPourJBYUyHxDpFQ4jS0tjOOE9uJb2PP/XDsBAQIRvo0M8c+//xzzlgAm7sAxYtNtj0ti8Kuq8oWgtvLMLDn369tZ3ZlX80cezqd2pPJxHYcx57P5zal9HdOsyx7GYbhQ2t08enph8tvwAWDvKBQ1wzhkG0zCJYRXHsEblwP10uI4wS2aQqYDH8PpRQQQs4s69HF8OTdVwAtBFlGahGs1DKMlBMSldFSCS4UY1wJIZTRmKZkC+cc4+wnHL+D53kjy7p/Pjw++4xnSBVFqcnL0uB3k9eVEVIYzDZSSaOkNEFUmGWUmyjemDQrTFFWCDV5USpa1eD7/mvLevD+yfHZZWs6TStTlRL+N9K8gjDawjraQElrQF/AmDBcSLyBbBw2gud7wSYoTJ7VWKcczD8EKUXBdQLreAtxkkKEJJvM0IrhBRS4rvunIJ5oaorNiWPQnCEcVF21GK2hZrx11rhBU9hI2awNxptc8PcOhztBITCoy4LpZLXWNS019klj9bVukFJjzTReV6MrDAndDIVgmwTu8cruqKnhs+M3X1DQgGAMjJSQrELgtMSyYj2l2IHrmonWIQoDxaeFjW9dMr5zTMgCn829tyePX330s81qGgSBE8fxLNoTJ8kvmr2/IDPXW8w8nyCLdo04N64/ISQg4/H4uYWjd+ugM+j1eoOj23d2M9LvdgfdwwPkcDd3cG5iSKfT/N8d9Pv9Pb02D7WOfgBNIckcQq0bDQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/13df702cc93665566d7da5aa292c848f/e93cc/bp.webp 300w,\n/static/13df702cc93665566d7da5aa292c848f/b0544/bp.webp 600w,\n/static/13df702cc93665566d7da5aa292c848f/68fc1/bp.webp 1200w,\n/static/13df702cc93665566d7da5aa292c848f/a2303/bp.webp 1800w,\n/static/13df702cc93665566d7da5aa292c848f/4293a/bp.webp 2400w,\n/static/13df702cc93665566d7da5aa292c848f/55924/bp.webp 2514w\"\n              sizes=\"(max-width: 1200px) 100vw, 1200px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/13df702cc93665566d7da5aa292c848f/eed55/bp.png 300w,\n/static/13df702cc93665566d7da5aa292c848f/7491f/bp.png 600w,\n/static/13df702cc93665566d7da5aa292c848f/8537d/bp.png 1200w,\n/static/13df702cc93665566d7da5aa292c848f/d2cc9/bp.png 1800w,\n/static/13df702cc93665566d7da5aa292c848f/00711/bp.png 2400w,\n/static/13df702cc93665566d7da5aa292c848f/3984b/bp.png 2514w\"\n            sizes=\"(max-width: 1200px) 100vw, 1200px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/13df702cc93665566d7da5aa292c848f/8537d/bp.png\"\n            alt=\"bp\"\n            title=\"bp\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"skip-trigger-the-pipelines\" style=\"position:relative;\"><a href=\"#skip-trigger-the-pipelines\" aria-label=\"skip trigger the pipelines permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Skip trigger the pipelines</h2>\n<p>You can include <code class=\"language-text\">[skip ci]</code> or <code class=\"language-text\">[ci skip]</code> anywhere in your commit message of the HEAD commit.\nAny commits that include <code class=\"language-text\">[skip ci]</code> or <code class=\"language-text\">[ci skip]</code> in the message are ignored by Pipelines.</p>\n<p>Ref: <a href=\"https://support.atlassian.com/bitbucket-cloud/docs/bitbucket-pipelines-faqs/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://support.atlassian.com/bitbucket-cloud/docs/bitbucket-pipelines-faqs/</a></p>\n<h1 id=\"configure-bitbucket-pipelinesyml\" style=\"position:relative;\"><a href=\"#configure-bitbucket-pipelinesyml\" aria-label=\"configure bitbucket pipelinesyml permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configure bitbucket-pipelines.yml</h1>\n<h2 id=\"build-on-branch\" style=\"position:relative;\"><a href=\"#build-on-branch\" aria-label=\"build on branch permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Build on branch</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">pipelines</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># Pipelines that run automatically on a commit to a branch</span>\n    <span class=\"token key atrule\">staging</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">...</span> </code></pre></div>\n<h2 id=\"pull-requests\" style=\"position:relative;\"><a href=\"#pull-requests\" aria-label=\"pull requests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pull Requests</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">pipelines</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">pull-requests</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">'**'</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">#this runs as default for any branch not elsewhere defined</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">...</span>\n    <span class=\"token key atrule\">feature/*</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">#any branch with a feature prefix</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">...</span></code></pre></div>\n<h2 id=\"parallel\" style=\"position:relative;\"><a href=\"#parallel\" aria-label=\"parallel permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Parallel</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">pipelines</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">master</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># non-parallel step</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build\n          <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> ./build.sh\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">parallel</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># these 2 steps will run in parallel</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Integration 1\n              <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> ./integration<span class=\"token punctuation\">-</span>tests.sh <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>batch 1\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Integration 2\n              <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> ./integration<span class=\"token punctuation\">-</span>tests.sh <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>batch 2</code></pre></div>\n<h2 id=\"reuse-steps\" style=\"position:relative;\"><a href=\"#reuse-steps\" aria-label=\"reuse steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reuse steps</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">definitions</span><span class=\"token punctuation\">:</span> \n  <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span> <span class=\"token important\">&amp;build-test</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and test\n        <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> yarn <span class=\"token important\">&amp;&amp;</span> yaml build \n\n<span class=\"token key atrule\">pipelines</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">develop</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*build-test</span>\n    <span class=\"token key atrule\">main</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*build-test</span>\n    <span class=\"token key atrule\">master</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">&lt;&lt;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*build-test</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Testing on master\n</code></pre></div>\n<p>Override values</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">definitions</span><span class=\"token punctuation\">:</span> \n  <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span> <span class=\"token important\">&amp;build-test</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and test\n        <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> yarn <span class=\"token important\">&amp;&amp;</span> yaml build \n\n<span class=\"token key atrule\">pipelines</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">develop</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">&lt;&lt;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*build-test</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Testing on master\n</code></pre></div>\n<h2 id=\"reuse-scripts\" style=\"position:relative;\"><a href=\"#reuse-scripts\" aria-label=\"reuse scripts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reuse scripts</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">definitions</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">scripts</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span> <span class=\"token important\">&amp;script-build-and-test</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\n        yarn\n        yarn test\n\n<span class=\"token key atrule\">pipelines</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">develop</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and test and deploy\n          <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> export NODE_ENV=develop\n            <span class=\"token punctuation\">-</span> <span class=\"token important\">*script-build-and-test</span>\n</code></pre></div>\n<h2 id=\"script-multiple-lines\" style=\"position:relative;\"><a href=\"#script-multiple-lines\" aria-label=\"script multiple lines permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Script multiple lines</h2>\n<p>Using <a href=\"https://yaml.org/spec/1.2/spec.html#id2795688\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">literal style block scalar</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">pipelines</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">develop</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and test and deploy\n          <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n              export NODE_ENV=develop DEBUG=false\n              yarn\n              yarn test\n              yarn build</span></code></pre></div>\n<p>or <a href=\"https://yaml.org/spec/1.2/spec.html#id2796251\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">folder block style</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">pipelines</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">develop</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and test and deploy\n          <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">></span><span class=\"token scalar string\">\n              export NODE_ENV=develop DEBUG=false\n              yarn\n              yarn test\n              yarn build</span></code></pre></div>\n<h2 id=\"using-service-for-one-step\" style=\"position:relative;\"><a href=\"#using-service-for-one-step\" aria-label=\"using service for one step permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using service for one step</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">pipelines</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">develop</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">&lt;&lt;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*build-test</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Testing on master\n        <span class=\"token key atrule\">caches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>docker<span class=\"token punctuation\">]</span>\n        <span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>docker<span class=\"token punctuation\">]</span>\n</code></pre></div>\n<h2 id=\"increase-docker-memory\" style=\"position:relative;\"><a href=\"#increase-docker-memory\" aria-label=\"increase docker memory permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Increase Docker memory</h2>\n<p>The Docker-in-Docker daemon used for Docker operations in\nPipelines is treated as a service container, and so has a default memory limit of 1024 MB</p>\n<p>This can also be adjusted to any value between 128 MB and 3072 or 7128 MB (2x - 8192 MB total, 1024 MB reserved).</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">definitions</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2048</span></code></pre></div>\n<h2 id=\"2x-for-all-steps\" style=\"position:relative;\"><a href=\"#2x-for-all-steps\" aria-label=\"2x for all steps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2x for all steps</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">options</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">size</span><span class=\"token punctuation\">:</span> 2x\n\n<span class=\"token key atrule\">definitions</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7128</span>\n\n\n<span class=\"token key atrule\">pipelines</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">develop</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">&lt;&lt;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*build-test</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Testing on master\n        <span class=\"token key atrule\">caches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>docker<span class=\"token punctuation\">]</span>\n        <span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>docker<span class=\"token punctuation\">]</span></code></pre></div>\n<h2 id=\"2x-for-one-step\" style=\"position:relative;\"><a href=\"#2x-for-one-step\" aria-label=\"2x for one step permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2x for one step</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">pipelines</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">develop</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">&lt;&lt;</span><span class=\"token punctuation\">:</span> <span class=\"token important\">*build-test</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Testing on master\n        <span class=\"token key atrule\">caches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>docker<span class=\"token punctuation\">]</span>\n        <span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>docker<span class=\"token punctuation\">]</span>\n        <span class=\"token key atrule\">size</span><span class=\"token punctuation\">:</span> 2x</code></pre></div>\n<h2 id=\"environment-variables\" style=\"position:relative;\"><a href=\"#environment-variables\" aria-label=\"environment variables permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Environment Variables</h2>\n<p>Pipelines provides a set of default variables that are available for builds, and can be used in scripts:\n<a href=\"https://support.atlassian.com/bitbucket-cloud/docs/variables-and-secrets/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://support.atlassian.com/bitbucket-cloud/docs/variables-and-secrets/</a></p>","fields":{"slug":"/2021/08/bitbucket-pipelines-notes.html","tagSlugs":["/tag/data-engineer/","/tag/git/","/tag/bitbucket/"]},"frontmatter":{"date":"2021-08-27T00:00:00.000+07:00","description":"Bitbucket Pipelines document is fragmented everywhere. It always makes me search for a while every time I write a new one for CI/CD. So I'll make a few notes here.","tags":["Data Engineer","Git","Bitbucket"],"title":"Bitbucket Pipelines Notes","fbCommentUrl":"none"}}},"pageContext":{"slug":"/2021/08/bitbucket-pipelines-notes.html"}},"staticQueryHashes":["251939775","2672868365","401334301"]}