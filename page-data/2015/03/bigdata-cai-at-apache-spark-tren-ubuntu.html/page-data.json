{"componentChunkName":"component---src-templates-post-template-tsx","path":"/2015/03/bigdata-cai-at-apache-spark-tren-ubuntu.html","result":{"data":{"markdownRemark":{"id":"60cd4292-f697-5c2c-95d4-5772d5e4c483","html":"<p>Trong lúc tìm hiểu vài thứ về BigData cho một số dự án, mình quyết định chọn Apache Spark thay cho Hadoop. Theo như giới thiệu từ trang chủ của Apache Spark, thì tốc độ của nó cao hơn 100x so với Hadoop MapReduce khi chạy trên bộ nhớ, và nhanh hơn 10x lần khi chạy trên đĩa, tương thích hầu hết các CSDL phân tán (HDFS, HBase, Cassandra, …). Ta có thể sử dụng Java, Scala hoặc Python để triển khai các thuật toán trên Spark.</p>\n<p>Chú ý: Đây là bài viết hướng dẫn cách cài đặt từ Source. Bạn có thể cài bản standalone thông qua bản pre-built. <a href=\"https://blog.duyet.net/2017/05/cai-apache-spark-standalone-ban-pre.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Xem bài viết hướng dẫn tại đây</a>.</p>\n<p>Spark có nhiều phiên bản khác nhau, tương thích với Hadoop và hầu hết các loại CSDL mà Hadoop hỗ trợ. Bạn có thể truy cập vào trang Downloads của Spark để chọn download phiên bản tương ứng.</p>\n<p><img src=\"https://1.bp.blogspot.com/-Ruz5XvIPJZo/VS5s2ElpdQI/AAAAAAAACQ0/G7LCMJ0klNk/s1600/download-spark.png\" alt=\"\"></p>\n<p>Sau đây mình sẽ hướng dẫn về các bước cần thiết để biên dịch, cài đặt và cấu hình Spark từ Source.</p>\n<h2 id=\"cài-đặt-java\" style=\"position:relative;\"><a href=\"#c%C3%A0i-%C4%91%E1%BA%B7t-java\" aria-label=\"cài đặt java permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cài đặt Java</h2>\n<p>Để có thể chạy Spark trên ubuntu, cần phải có Java. Nếu chưa có thì cài đặt như sau, chạy các lệnh:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">sudo</span> apt-add-repository ppa:webupd8team/java\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> oracle-java7-installer</code></pre></div>\n<p>Kiểm tra lại đã cài đặt thành công hay chưa</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ java -version</code></pre></div>\n<p>Bạn sẽ thấy</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">java version &quot;1.7.0_76&quot; Java(TM) SE Runtime Environment (build 1.7.0_76-b13) Java HotSpot(TM) 64-Bit Server VM (build 24.76-b04, mixed mode)</code></pre></div>\n<h2 id=\"cài-đặt-scala\" style=\"position:relative;\"><a href=\"#c%C3%A0i-%C4%91%E1%BA%B7t-scala\" aria-label=\"cài đặt scala permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cài đặt Scala</h2>\n<p>Tiếp theo là cài đặt Scala, bạn có thể tìm hiểu thêm về Scala tại <a href=\"http://www.scala-lang.org/index.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">trang chủ</a></p>\n<p>Tải bản Scala 2.11.6 tại đây: <a href=\"http://www.scala-lang.org/download/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://www.scala-lang.org/download/</a>\nGiải nén, chép hết các file vào /usr/local/src/scala/. Ai lười thì lần lượt chạy các lệnh sau</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ cd ~/Downloads\n$ wget http://www.scala-lang.org/files/archive/scala-2.11.6.tgz\n$ sudo tar xvf ./scala-2.11.6.tgz\n$ sudo mkdir /usr/local/src/scala\n$ sudo cp scala-2.11.6 /usr/local/src/scala/</code></pre></div>\n<p>Mở file .bashrc và thêm 2 dòng sau vào cuối cùng</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export SCALA_HOME=/usr/local/src/scala/scala-2.11.6\nexport PATH=$SCALA_HOME/bin:$PATH</code></pre></div>\n<p>Khởi động lại .bashrc để nạp lại các biến ENV</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ source .bashrc</code></pre></div>\n<p>Kiểm tra xem Scala đã cài đặt thành công hay chưa</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ scala -version</code></pre></div>\n<p>Thấy giống giống thế này là Ok:\n<code class=\"language-text\">Scala code runner version 2.11.6 -- Copyright 2002-2013, LAMP/EPFL</code></p>\n<h2 id=\"tải-và-cài-đặt-apache-spark\" style=\"position:relative;\"><a href=\"#t%E1%BA%A3i-v%C3%A0-c%C3%A0i-%C4%91%E1%BA%B7t-apache-spark\" aria-label=\"tải và cài đặt apache spark permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tải và cài đặt Apache Spark</h2>\n<p>Truy cập <a href=\"http://spark.apache.org/downloads.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://spark.apache.org/downloads.html</a> và tải bản Spark mới nhất, hoặc làm theo cách dưới đây</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ cd ~/Downloads\n$ wget http://mirrors.viethosting.vn/apache/spark/spark-1.3.0/spark-1.3.0.tgz\n$ tar xvf spark-1.3.0.tgz \n</code></pre></div>\n<h2 id=\"biên-dịch-spark\" style=\"position:relative;\"><a href=\"#bi%C3%AAn-d%E1%BB%8Bch-spark\" aria-label=\"biên dịch spark permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Biên dịch Spark</h2>\n<p>Trong source của Spark mới vừa tải về đã tích hợp sẵn SBT(Simple Build Tool), để biên dịch Spark, chạy các lệnh sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ cd spark-1.3.0\n$ sbt/sbt assembly</code></pre></div>\n<p>Ăn miếng nước, uống miếng bánh, đợi 1 vài (chục) phút để SBT build.</p>\n<h2 id=\"test-thử\" style=\"position:relative;\"><a href=\"#test-th%E1%BB%AD\" aria-label=\"test thử permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test thử</h2>\n<p>Sau thời gian chờ đợi, bạn đã có thể sử dụng. Test thử nào, sau đây là chương trình tính số Pi, tích hợp sẵn trong Spark</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ./bin/run-example SparkPi 10</code></pre></div>\n<p>Kết quả 3.14634, hệ thống của bạn đã sẵn sàng chinh chiến.</p>\n<h2 id=\"sử-dụng-spark-submit\" style=\"position:relative;\"><a href=\"#s%E1%BB%AD-d%E1%BB%A5ng-spark-submit\" aria-label=\"sử dụng spark submit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sử dụng spark-submit</h2>\n<p>Một khi bạn đã viết xong vài thuật toán nho nhỏ trên API của Spark, đây là lúc chạy trên Spark. Spark-Submit là một script (bin/spark-submit), giúp bạn submit chương trình của bạn lên Spark và chạy. Bạn có thể Submit file Jar nếu viết app bằng Java, đường dẫn file .py nếu viết bằng python, …</p>\n<p>Trong thư mục Spark mặc định có chứa nhiều file ví dụ trong thư mục examples, bằng ngôn cả ngôn ngữ Java, Scala và Python.</p>\n<p>Thử nhé, submit thuật toán tính số PI</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ./bin/spark-submit examples/src/main/python/pi.py</code></pre></div>\n<p>Cách Submit file .jar</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./bin/spark-submit \\\n  --class &lt;main-class&gt;\n  --master &lt;master-url&gt; \\\n  --deploy-mode &lt;deploy-mode&gt; \\\n  --conf &lt;key&gt;=&lt;value&gt; \\\n  ... # other options\n  &lt;application-jar&gt; \\\n  [application-arguments]</code></pre></div>\n<p>Một số ví dụ về cách sử dụng Spark-Submit</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Chạy application trên máy đơn với 8 cores\n./bin/spark-submit \\\n  --class org.apache.spark.examples.SparkPi \\\n  --master local[8] \\\n  /path/to/examples.jar \\\n  100\n\n# Chạy Spark Standalone cluster ở chế độ deploy\n./bin/spark-submit \\\n  --class org.apache.spark.examples.SparkPi \\\n  --master spark://207.184.161.138:7077 \\\n  --executor-memory 20G \\\n  --total-executor-cores 100 \\\n  /path/to/examples.jar \\\n  1000\n\n# Chạy trên YARN cluster\nexport HADOOP_CONF_DIR=XXX\n./bin/spark-submit \\\n  --class org.apache.spark.examples.SparkPi \\\n  --master yarn-cluster \\  # can also be `yarn-client` for client mode\n  --executor-memory 20G \\\n  --num-executors 50 \\\n  /path/to/examples.jar \\\n  1000\n\n# Chạy application trên Spark ở chế độ Standalone\n./bin/spark-submit \\\n  --master spark://207.184.161.138:7077 \\\n  examples/src/main/python/pi.py \\\n  1000 # tham số</code></pre></div>\n<h2 id=\"sử-dụng-spark-shell\" style=\"position:relative;\"><a href=\"#s%E1%BB%AD-d%E1%BB%A5ng-spark-shell\" aria-label=\"sử dụng spark shell permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sử dụng Spark Shell</h2>\n<p>Bạn có thể sử dụng Spark thông qua Scala Shell</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ./spark-shell</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">scala&gt; val textFile = sc.textFile(&quot;README.md&quot;)\nscala&gt; textFile.count()</code></pre></div>\n<h2 id=\"kết-hợp-spark-với-hadoop-filesystems-hdfs\" style=\"position:relative;\"><a href=\"#k%E1%BA%BFt-h%E1%BB%A3p-spark-v%E1%BB%9Bi-hadoop-filesystems-hdfs\" aria-label=\"kết hợp spark với hadoop filesystems hdfs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kết hợp Spark với Hadoop Filesystems (HDFS)</h2>\n<p>Ở trên mình hướng dẫn cách build từ source, cách này có cái hay là bạn có thể chạy Spark với bất kì phiên bản Hadoop nào. Bây giờ mình muốn sử dụng kết hợp với HDFS thì sao? thực hiện các bước sau</p>\n<p>Dọn dẹp</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ sbt/sbt clean</code></pre></div>\n<p>Bạn có thể thay đổi phiên bản của SPARK_HADOOP_VERSION, ở đây mình dùng 2.0.0-cdh4.3.0</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ SPARK_HADOOP_VERSION=2.0.0-mr1-cdh4.3.0 sbt/sbt assembly</code></pre></div>\n<p>Sau khi build thành công, bạn đã có thể đọc và ghi dữ liệu lên cdh4.3.0 clusters</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ./spark-shell</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">scala&gt; var file = sc.textFile(&quot;hdfs://IP:8020/path/to/textfile.txt&quot;)\nscala&gt; file.flatMap(line =&gt; line.split(&quot;,&quot;)).map(word =&gt; (word, 1)).reduceByKey(_+_)\nscala&gt; count.saveAsTextFile(&quot;hdfs://IP:8020/path/to/ouput&quot;)</code></pre></div>\n<h2 id=\"kết\" style=\"position:relative;\"><a href=\"#k%E1%BA%BFt\" aria-label=\"kết permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kết</h2>\n<p>Cách cấu hình Spark để chạy MultiNode trên YARN: <a href=\"https://spark.apache.org/docs/1.2.0/running-on-yarn.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://spark.apache.org/docs/1.2.0/running-on-yarn.html</a>\nQuick Start: <a href=\"http://spark.apache.org/docs/1.1.1/quick-start.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://spark.apache.org/docs/1.1.1/quick-start.html</a></p>","fields":{"slug":"/2015/03/bigdata-cai-at-apache-spark-tren-ubuntu.html","tagSlugs":["/tag/apache/","/tag/python/","/tag/spark/","/tag/big-data/","/tag/hadoop/"]},"frontmatter":{"date":"2015-03-27T00:38:00.004+07:00","description":"Trong lúc tìm hiểu vài thứ về BigData cho một số dự án, mình quyết định chọn Apache Spark thay cho Hadoop. Theo như giới thiệu từ trang chủ của Apache Spark, thì tốc độ của nó cao hơn 100x so với Hadoop MapReduce khi chạy trên bộ nhớ, và nhanh hơn 10x lần khi chạy trên đĩa, tương thích hầu hết các CSDL phân tán (HDFS, HBase, Cassandra, ...). Ta có thể sử dụng Java, Scala hoặc Python để triển khai các thuật toán trên Spark.","tags":["Apache","Python","Spark","BigData","Hadoop"],"title":"BigData - Cài đặt Apache Spark trên Ubuntu 14.04","fbCommentUrl":null}}},"pageContext":{"slug":"/2015/03/bigdata-cai-at-apache-spark-tren-ubuntu.html"}},"staticQueryHashes":["251939775","2672868365","401334301"]}