{"componentChunkName":"component---src-templates-post-template-js","path":"/2015/09/nodejs-all-you-need-to-know-about.html","result":{"data":{"markdownRemark":{"id":"b5c11b8a-c5d3-524b-b336-040aac718451","html":"<p>Now – that Node.js 4.0.0 is about to be officially released – you may wonder what it delivers to you and if you should upgrade right away, or not. This post covers the most important changes you need to know, and some key implications you may have to take into account in making your decision.</p>\n<p><img src=\"https://2.bp.blogspot.com/-h7ljxkRrImE/VfAcZ8U9dlI/AAAAAAAAC4U/wYPnnlhcP3Y/s1600/nodejs_logo_light.png\"></p>\n<h2 id=\"update-09-08-15\" style=\"position:relative;\"><a href=\"#update-09-08-15\" aria-label=\"update 09 08 15 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Update 09-08-15</h2>\n<p>In my initial blog post I came to the conclusion that there is no real difference in performance between 0.12 and 4.0.0. With a last minute enhancement this has now changed and there are significant performance gains now. Read on for more information.</p>\n<h2 id=\"the-story-so-far\" style=\"position:relative;\"><a href=\"#the-story-so-far\" aria-label=\"the story so far permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Story so far</h2>\n<p>The last few months were really exciting for the Node.js community.</p>\n<p>At the start of this year Joyent Inc. handed over the project to the community around io.js, a fork of Node.js. Soon after that, it was decided that there should be only one version that incorporates all current features of io.js and Node.js in the future.</p>\n<p>Bringing together two codebases that drifted away from each other for many months is a huge endeavor. When I was told about it at <a href=\"http://nodeconf.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NodeConf</a> in June, initially I was pessimistic about the planned time frame of about 3 months.</p>\n<p>I’m really stunned that actually a new converged Node.js 4.0.0 is round the corner.</p>\n<p><img src=\"https://2.bp.blogspot.com/-OUIjmz20GsU/Ve_Or1QJRCI/AAAAAAAAC3g/q6_kYTlsk2s/s1600/600x450xnodeconf-600x450.jpg.pagespeed.ic.t8ry0mwT9n.webp\"></p>\n<p>io.js, Node.js and npm developers discussing Native modules at NodeConf Adventure at a Ranch somewhere in California :)</p>\n<h2 id=\"why-400\" style=\"position:relative;\"><a href=\"#why-400\" aria-label=\"why 400 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why “4.0.0”?</h2>\n<p>The io.js project uses semantic versioning (semver) with its first major release being a 1.0.</p>\n<p>The current main line of io.js is 3.x. To avoid collisions with the 0.x scheme of Node.js it was decided that the converged version should be a 4.0.0 and will also be following the semver scheme <major>.<minor>.<patch> from now on.</p>\n<h2 id=\"so--whats-new\" style=\"position:relative;\"><a href=\"#so--whats-new\" aria-label=\"so  whats new permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>So … what’s new</h2>\n<p>Node.js 4.0.0 aims to provide an easy update path for current users of io.js and node and so there are no major/breaking API changes. Nevertheless there are many small improvements and changes. I recommend reviewing the changelog and running extensive tests before updating your production environments.</p>\n<p>Let’s review the most important changes.</p>\n<h3 id=\"new-v8-version-and-its-implications\" style=\"position:relative;\"><a href=\"#new-v8-version-and-its-implications\" aria-label=\"new v8 version and its implications permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>New V8 Version (and its implications)</h3>\n<p>One reason for creating io.js in the first place were unpredictable and long release cycles.</p>\n<p>Node.js and io.js heavily depend on Googles V8 JavaScript engine which is under constant development and improvement and the project was falling behind quickly.</p>\n<p>Node.js 4.0.0 now uses a recent version of V8 (4.5 compared to 3.28.x in node 0.12, to be exact)  – this is great because it offers new language features (see below) but comes with a cost:</p>\n<p>Node.js projects usually heavily depend on modules. A fraction of them are native – this means that they are written in C++ and are linked against V8.</p>\n<p>Without precautions every new V8 version will break all native modules. To remedy this, there is an abstraction library called Nan that provides Macros and an API for different versions of V8. So one module that uses Nan will usually work with all versions from 0.8 to 0.12.</p>\n<p>With Node.js 4.0.0 Nan took the chance to do some refactoring and also bumped its version from 1.x to 2.x, introducing breaking changes.</p>\n<p>This means that a native module needs to be modified to use Nan 2.x to work with Node.js 4.0.0.</p>\n<p>For regular users of Node.js the consequence is that some native modules used their projects may cease to work if there is no update available. This might be a deal breaker for some but maybe this is also a chance to closely review all the modules used and look for actively maintained alternatives.</p>\n<p>You are also free to fork modules and port them to Nan2. I just did this with node-gc-profiler. Here’s also a diff that shows the changes that were necessary.</p>\n<p>After covering the not-so-exiting implications let’s look at what you get in return:</p>\n<h3 id=\"extended-es6-support\" style=\"position:relative;\"><a href=\"#extended-es6-support\" aria-label=\"extended es6 support permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Extended ES6 support</h3>\n<p><a href=\"http://www.ecma-international.org/publications/standards/Ecma-262.htm\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ECMA-262</a> is the latest version of the JavaScript language specification and – by building on a recent V8 version – Node.js 4.0.0 supports many new language features out of the box.</p>\n<p>Here are some examples</p>\n<ul>\n<li>Block scoping using let and const</li>\n<li>Classes. Yes really, JavaScript now supports classes but they are just syntactic sugar built around the prototypical inheritance model of JavaScript. So if you are using CoffeeScript because you just can not live without having a ‘class’ keyword this new feature is for you.</li>\n<li>Generators (function*, next and yield) It makes sense to get used to- and understand them. They will be heavily used in the future. koa.js, for instance, was built by the express folks and heavily depends on them.</li>\n</ul>\n<p>Please find a complete list of currently supported ES6 features here: <a href=\"https://nodejs.org/en/docs/es6/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ES6 in Node.js 4.0.0.</a></p>\n<h3 id=\"performance\" style=\"position:relative;\"><a href=\"#performance\" aria-label=\"performance permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Performance</h3>\n<p>This is no longer true. I ran my initial performance tests against an early release candidate and there were no significant performance gains. After release candidate 4 introduced <a href=\"https://github.com/nodejs/node/pull/2732\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">improved V8 ArrayBuffer</a> handling I redid my tests and now … well let’s look at it.</p>\n<p>For my tests I used a simple express application and created some load using <a href=\"http://httpd.apache.org/docs/2.2/programs/ab.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ab</a>.</p>\n<p>First I wanted to know the difference in request performance and collected the number of requests per second and the time a single request took.</p>\n<p><img src=\"https://1.bp.blogspot.com/-XHZNq3GGTx8/Ve_P0jZLTiI/AAAAAAAAC3s/9vfHvoG1BBc/s1600/600x307xexpress_performance1-600x307.png.pagespeed.ic.Uo4X4tIjj9.png\"></p>\n<p>Overall performance of Node.js 4.0.0 compared to 0.12 and and 0.10</p>\n<p>We clearly see that there is a performance gain of roughly 20% between the examined Node.js versions. 0.12 was even slower than 0.10 and 4.0.0 is much faster than both.</p>\n<p>Using process.memoryUsage() I also graphed out the memory usage split into Resident Set Size, Heap Total and Heap Used.</p>\n<p><img src=\"https://4.bp.blogspot.com/-SDTlKm-i6VQ/Ve_P-UcpW9I/AAAAAAAAC30/7NUlmiuNg6I/s1600/600x281xexpress_memory1-600x281.png.pagespeed.ic.Q2tECVnMNa.png\"></p>\n<p>Comparing Memory Usage</p>\n<p>The results are neither exiting nor disappointing although we see at a first glance that 0.10 demands less overall memory and 4.0.0 the most heap but V8 does a good job in reserving memory that is available on the system. So the higher figures for 0.12 and 4.0.0 may simply mean that V8’s memory handling has changed between the versions and that it now simply allocates more resources beforehand. I’ve also collected some metrics and charts that justify this but this would go beyond the scope of this post, so I will do a separate one on Node.js memory handling and garbage collection in the near future.</p>\n<p>After all we can say that you can expect significant performance gains with 4.0.0 and that you may probably want to keep an eye on your memory usage.</p>\n<h3 id=\"long-term-support-lts-versions\" style=\"position:relative;\"><a href=\"#long-term-support-lts-versions\" aria-label=\"long term support lts versions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Long Term Support (LTS) Versions</h3>\n<p>Rolling out a new version in bigger environments (including testing and fixing things) often takes months and needs to be well planned – especially for enterprises the lack of a predictable release schedule was cumbersome in the past.</p>\n<p>Establishing a LTS policy is a really big step and one of the most important things surrounding the release of 4.0.0.</p>\n<p>This means</p>\n<ul>\n<li>There will be LTS releases every 12 months</li>\n<li>Every LTS version will be active for this 12 months</li>\n<li>After that every LTS version will be in maintenance mode for another 18 months</li>\n<li>The first LTS release will be in October. If you deploy it then, you can rely on it for 30 months.</li>\n</ul>\n<p><img src=\"https://2.bp.blogspot.com/-HIqv87yBHWI/Ve_csiWb2jI/AAAAAAAAC4E/1aOWGHHSO-8/s1600/600x275xstrawmanschedule-600x275.png.pagespeed.ic.rs6_g0ZSH6.png\"></p>\n<p>There is a <a href=\"https://github.com/nodejs/LTS\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">dedicated LTS sub-project on GitHub</a>. I encourage you to review it.</p>\n<h2 id=\"dynatrace-and-nodejs-400\" style=\"position:relative;\"><a href=\"#dynatrace-and-nodejs-400\" aria-label=\"dynatrace and nodejs 400 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dynatrace and Node.js 4.0.0</h2>\n<p>While we already working on porting the native parts of our Node.js agent to Nan 2 we have decided that we will align with Nodes new LTS schedule and ship a new version in early November.</p>\n<h2 id=\"tldr\" style=\"position:relative;\"><a href=\"#tldr\" aria-label=\"tldr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TL/DR</h2>\n<ul>\n<li>4.0.0 is the future of Node.js. If you start a new project today use it.</li>\n<li>The request performance is roughly 20% better than 0.12 – this is a significant gain.</li>\n<li>The switch to a new V8 version and the introduction of Nan 2.0 has implications on native modules and some not maintained ones may cease to work (but you should get rid of them anyway then)</li>\n<li>4.0.0 uses a recent V8 version and offers many new language features from ES6</li>\n<li>The introduction of Long Term Support (LTS) is one of the most important and highly demanded new “features”</li>\n</ul>\n<h2 id=\"did-i-miss-anything\" style=\"position:relative;\"><a href=\"#did-i-miss-anything\" aria-label=\"did i miss anything permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Did I miss anything?</h2>\n<p>I’m eager to hear your impressions with Node.js 4.0.0.</p>\n<p>When will you switch to 4.0.0?</p>\n<p>How does your migration procedure look like?</p>\n<p>Have you experienced any problems yet not mentioned here?</p>\n<p>Are there any big benefits I’ve missed?</p>\n<p>Are you happy about the LTS schedule?</p>\n<p>Source: <a href=\"http://apmblog.dynatrace.com/2015/09/05/all-you-need-to-know-about-node-js-4-0/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://apmblog.dynatrace.com/2015/09/05/all-you-need-to-know-about-node-js-4-0/</a></p>","fields":{"slug":"/2015/09/nodejs-all-you-need-to-know-about.html","tagSlugs":["/tag/nodejs/","/tag/update/"]},"frontmatter":{"date":"2015-09-09T14:17:00.004+07:00","description":"Now – that Node.js 4.0.0 is about to be officially released – you may wonder what it delivers to you and if you should upgrade right away, or not. This post covers the most important changes you need to know, and some key implications you may have to take into account in making your decision.","tags":["Nodejs","Update"],"title":"Nodejs - All you need to know about Node.js 4.0.0","fbCommentUrl":"none"}}},"pageContext":{"slug":"/2015/09/nodejs-all-you-need-to-know-about.html"}}}