{"componentChunkName":"component---src-templates-post-template-tsx","path":"/2016/05/dockerizing-nodejs.html","result":{"data":{"markdownRemark":{"id":"27f84cf7-73c8-5a08-82b2-9cff120082a4","html":"<p><a href=\"https://blog.duyet.net/2015/12/docker-la-gi-co-ban-ve-docker.html#.VyYMd4N94_M\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Docker ra đời</a> cho giải pháp đóng gói, vận chuyển và triển khai ứng dụng hết sức nhanh chóng và đơn giản. Với Docker, các thành viên trong team (cũng như với người muốn trải nghiệm thử project) sẽ triển khai ngay được môi trường ứng dụng mà không phải mất nhiều thời gian, công việc của SysAdmin cũng nhẹ nhàng hơn.</p>\n<p>Bài sau tôi sẽ hướng dẫn cách đóng gói và build image docker cho ứng dụng Nodejs một cách cơ bản nhất.</p>\n<p><a href=\"https://blog.duyet.net/2016/05/dockerizing-nodejs.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"https://1.bp.blogspot.com/-PdJFod9lQSU/VyYyDa_nEnI/AAAAAAAAUaE/CpGySWOh_TMGvZGjYqpcSHtTft7yi7tjwCK4B/s400/1-_MtS4HqN2srTcrSyet61DQ.jpeg\" alt=\"\"></a></p>\n<h2 id=\"cài-đặt-docker\" style=\"position:relative;\"><a href=\"#c%C3%A0i-%C4%91%E1%BA%B7t-docker\" aria-label=\"cài đặt docker permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cài đặt Docker</h2>\n<p>Tôi sử dụng Ubuntu, <a href=\"https://blog.duyet.net/2016/05/cai-dat-docker-tren-ubuntu.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">xem cách cài Docker trên Ubuntu</a>. Với các nền tảng khác, xem tại trang Guide tại trang chủ Docker (<a href=\"https://docs.docker.com/engine/installation/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://docs.docker.com/engine/installation/</a>).</p>\n<h2 id=\"chuẩn-bị-ứng-dụng-cần-đóng-gói\" style=\"position:relative;\"><a href=\"#chu%E1%BA%A9n-b%E1%BB%8B-%E1%BB%A9ng-d%E1%BB%A5ng-c%E1%BA%A7n-%C4%91%C3%B3ng-g%C3%B3i\" aria-label=\"chuẩn bị ứng dụng cần đóng gói permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Chuẩn bị ứng dụng cần đóng gói</h2>\n<p>Bạn chuẩn bị ứng dụng Nodejs cần đóng gói và triển khai. Ở đây tôi sẽ sử dụng <a href=\"https://github.com/saveto-co/saveto\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">source</a> của trang <a href=\"https://saveto.co/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://saveto.co</a> viết bằng <a href=\"https://blog.duyet.net/2016/04/gioi-thieu-koajs.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Koajs</a>. Mã nguồn tải về ở đây: <a href=\"https://github.com/saveto-co/saveto\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/saveto-co/saveto</a></p>\n<p>Mỗi ứng dụng viết bằng Nodejs bắt buộc đều phải có <code class=\"language-text\">package.json</code>, lưu thông tin về các gói cần thiết, nhiều thông tin khác về tên, phiên bản, …</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\n  \"name\": \"quick-koa\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Quick by Koa\",\n  \"main\": \"app.js\",\n  \"scripts\": {\n    \"start\": \"node app.js\"\n  },\n  \"keywords\": [\n    \"Quick\",\n    \"shorten\",\n    \"link\",\n    \"jslab\",\n    \"duyetdev\"\n  ],\n  \"homepage\": \"http://saveto.co\",\n  \"repository\": \"git://github.com/duyet/quick.git\",\n  \"author\": \"Van-Duyet Le &lt;me@duyet.net>\",\n  \"license\": \"MIT\",\n  \"dependencies\": {\n    \"bcrypt-nodejs\": \"0.0.3\",\n    \"co\": \"^4.6.0\",\n    ...\n    \"validator\": \"^4.8.0\"\n  },\n  \"devDependencies\": {\n    \"nodemon\": \"^1.8.1\"\n  }\n}</code></pre></div>\n<p><a href=\"http://saveto.co/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Saveto.co</a> còn có thêm <code class=\"language-text\">bower.json</code> mô tả những thư viện frontend nào sẽ được sử dụng.</p>\n<h2 id=\"tạo-dockerfile\" style=\"position:relative;\"><a href=\"#t%E1%BA%A1o-dockerfile\" aria-label=\"tạo dockerfile permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tạo Dockerfile</h2>\n<p><code class=\"language-text\">Dockerfile</code> sẽ mô tả các bước để Docker build ảnh của ứng dụng, gồm các layer nào.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">touch Dockerfile</code></pre></div>\n<p>Mở file <code class=\"language-text\">Dockerfile</code> bằng Editor. Đầu tiên, cần định nghĩa ứng dụng sẽ build trên image nào. Do saveto.co yêu cầu Nodejs >= v4.0, tôi sẽ sử dụng bản Nodejs 5.11 ổn định. Danh sách các image Nodejs có <a href=\"https://hub.docker.com/_/node/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tại đây</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FROM node:5.11</code></pre></div>\n<p>Maintainer mô tả về người build docker image</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">MAINTAINER Van-Duyet Le &lt;me@duyet.net></code></pre></div>\n<p>Kế tiếp, ta tạo thư mục chứa source code trong Docker container:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Create app directory\nRUN mkdir -p /usr/src/app\nWORKDIR /usr/src/app</code></pre></div>\n<p>Docker Image gốc là Nodejs nên sẽ có sẵn NPM, tiếp tôi sẽ copy <code class=\"language-text\">package.json</code> vào và cài đặt các package ứng dụng yêu cầu:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Install app dependencies\nCOPY package.json /usr/src/app/\nRUN npm install</code></pre></div>\n<p>Sử dụng <code class=\"language-text\">COPY</code> để đưa hết source code vào container:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Bundle app source\nCOPY . /usr/src/app</code></pre></div>\n<p>Cài thêm Bower và chạy Bower để cài các thư viện frontend</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Install and run Bower\nRUN npm install -g bower\nRUN bower install</code></pre></div>\n<p>Saveto.co mặc định chạy ở port <code class=\"language-text\">6969</code>, tôi sử dụng <code class=\"language-text\">EXPOSE</code> để mở PORT 6969 trên Container, thay <code class=\"language-text\">6969</code> bằng port ứng dụng của bạn:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">EXPOSE 6969</code></pre></div>\n<p>Cuối cùng quan trọng nhất là lệnh để khởi động ứng dụng Nodejs, lệnh CMD sẽ chạy <code class=\"language-text\">npm start</code>, cũng như start <code class=\"language-text\">node app.js</code> được định nghĩa trong <code class=\"language-text\">package.json</code></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">CMD [ \"npm\", \"start\" ]</code></pre></div>\n<p>Tôi được file Dockerfile hoàn chỉnh như thế này:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FROM node:5.11\n\nMAINTAINER Van-Duyet Le &lt;me@duyet.net>\n\n# Create app directory\nRUN mkdir -p /usr/src/app\nWORKDIR /usr/src/app\n\n# Install NPM\nCOPY package.json /usr/src/app/\nRUN npm install\n\n# Bundle app source\nCOPY . /usr/src/app\n\n# Install and run Bower\nRUN npm install -g bower\nRUN bower install\n\nEXPOSE 6969\n\nCMD [\"npm\",\"start\"]</code></pre></div>\n<h2 id=\"build-image\" style=\"position:relative;\"><a href=\"#build-image\" aria-label=\"build image permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Build image</h2>\n<p>Cd đến thư mục chứa Dockerfile, chạy lệnh bên dưới để build image. —tag dùng để đặt tên cho ảnh dễ nhớ, nhớ đừng bỏ xót dấu chấm ở cuối</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ docker build -t duyetdev/saveto .</code></pre></div>\n<p><a href=\"https://4.bp.blogspot.com/-jD52kEZB4-8/VyYuFInnraI/AAAAAAAAUZ0/-c21J642VJoPF0pHN44nNf1owMfg7F1rACLcB/s1600/Screenshot%2Bfrom%2B2016-05-01%2B23-25-04.png\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"https://4.bp.blogspot.com/-jD52kEZB4-8/VyYuFInnraI/AAAAAAAAUZ0/-c21J642VJoPF0pHN44nNf1owMfg7F1rACLcB/s1600/Screenshot%2Bfrom%2B2016-05-01%2B23-25-04.png\" alt=\"\"></a></p>\n<p>Sau khi build thành công, xem lại danh sách Docker image bằng:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">root@duyetdev:~/saveto# docker images \n\nREPOSITORY                         TAG                 IMAGE ID            CREATED             SIZE\nnode                               5.11                8593e962b570        9 days ago          644.3 MB\nduyetdev/saveto                    latest              5e8c25e32c8b        5 minutes ago       1.067 GB\n</code></pre></div>\n<h2 id=\"run-the-image\" style=\"position:relative;\"><a href=\"#run-the-image\" aria-label=\"run the image permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Run the image</h2>\n<p>Run docker image với tùy chọn -d sẽ chạy container dưới background, tùy chọn -p sẽ mapping port của máy thật (public) với port của container (private)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">root@duyetdev:~/saveto# docker run -p 6969:6969 -d duyetdev/saveto\n62cd21863c2fce3a1e9076d07c68fb32c0172d37c5fb9f2ea536a16a12fa527b</code></pre></div>\n<p>62cd21863c2fce3a1e9076d07c68fb32c0172d37c5fb9f2ea536a16a12fa527b là ID của container.\nXem danh sách các container và log đang chạy:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Get container ID\n$ docker ps\n\n# Print app output\n$ docker logs &lt;container id>\n</code></pre></div>\n<p>Nếu cần truy cập vào container đang chạy, sử dụng:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Enter the container\n$ docker exec -it &lt;container id> /bin/bash</code></pre></div>\n<p>Test: truy cập thử ứng dụng bằng trình duyệt: <a href=\"http://localhost:6969/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:6969</a></p>\n<p><img src=\"https://4.bp.blogspot.com/-lBI9EPH-ck4/VyYy72_trTI/AAAAAAAAUaM/O8qnBPlgyv4oWGDEqs2O5zXiE6aRIfmHwCLcB/s1600/Screenshot%2Bfrom%2B2016-05-01%2B23-45-24.png\" alt=\"\"></p>\n<p>Chúc bạn thành công.</p>\n<h2 id=\"tham-khảo-thêm\" style=\"position:relative;\"><a href=\"#tham-kh%E1%BA%A3o-th%C3%AAm\" aria-label=\"tham khảo thêm permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tham khảo thêm</h2>\n<ul>\n<li><a href=\"https://nodejs.org/en/docs/guides/nodejs-docker-webapp/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Dockerizing a Node.js web app</a></li>\n<li><a href=\"https://blog.duyet.net/2015/12/docker-la-gi-co-ban-ve-docker.html#.VyYMd4N94_M\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Docker là gì? Cơ bản về Docker</a></li>\n<li><a href=\"https://blog.duyet.net/2016/05/cai-dat-docker-tren-ubuntu.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Cài đặt Docker trên Ubuntu</a></li>\n</ul>\n<p>(Ảnh: Airpair)</p>","fields":{"slug":"/2016/05/dockerizing-nodejs.html","tagSlugs":["/tag/ahihi-club/","/tag/docker-image/","/tag/nodejs/","/tag/docker/","/tag/koa/","/tag/dockerfile/","/tag/saveto-co/","/tag/docker-build/"]},"frontmatter":{"date":"2016-05-01T23:58:00.000+07:00","description":"Hướng dẫn cách đóng gói và build image docker cho ứng dụng Nodejs một cách cơ bản nhất.","tags":["ahihi.club","Docker image","Nodejs","docker","koa","Dockerfile","saveto.co","Docker build"],"title":"Đóng gói và triển khai ứng dụng Nodejs bằng Docker","fbCommentUrl":"none"}}},"pageContext":{"slug":"/2016/05/dockerizing-nodejs.html"}},"staticQueryHashes":["251939775","2672868365","401334301"]}