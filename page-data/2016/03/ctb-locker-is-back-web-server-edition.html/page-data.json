{"componentChunkName":"component---src-templates-post-template-tsx","path":"/2016/03/ctb-locker-is-back-web-server-edition.html","result":{"data":{"markdownRemark":{"id":"8d161ffd-d2f0-5f41-b4f8-1881db9e0bda","html":"<p>Cryptolockers have become more and more sophisticated, bypassing system protections and terrifying anyone in their path. TeslaCrypt, CryptoWall, TorrentLocker, Locky and CTB-Locker are only some of the malware we have protected from for the past two years. We have seen many shapes and colors of cryptolockers, but the new CTB-Locker variant says it all. The world of cybercriminals is investing in how to reinvent cryptolockers.</p>\n<p>Before, CTB-Locker, or Onion Ransomware, differed from other ransomware in the usage of the Tor Project’s anonymity network to shield itself from takedown efforts that rely largely on static malware command and control servers. Its use of Tor also helped evading detection and blocking. Another thing that protected CTB-Locker controllers was accepting as payment only Bitcoins, the decentralized and largely anonymous crypto-currency known.</p>\n<h2 id=\"defacement\" style=\"position:relative;\"><a href=\"#defacement\" aria-label=\"defacement permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Defacement</h2>\n<p>This new variant aims to encrypt web servers and demand less than half a bitcoin as a ransom (0.4 BTC). If payment isn’t sent on time the ransom is doubled to approximately. When paid, the decryption key is generated and is used to decrypt the web server’s files.</p>\n<p><img src=\"https://3.bp.blogspot.com/-OCj_qVWa3gQ/VtXfet69CWI/AAAAAAAAQiY/xhQ9CDVm7cg/s1600/ctb_locker_en_1.png\" alt=\"\"></p>\n<p>In this case, the defacement, which contains a replacement of the main php/html page, is used as the message carrier and contains all the means necessary for the attack to leave the right impression on the victim. We will deep-dive into it in the next steps.</p>\n<p>It is important to mention that the original code is not deleted. It is stored safely in the web root with a different name in an encrypted state.</p>\n<h2 id=\"the-message\" style=\"position:relative;\"><a href=\"#the-message\" aria-label=\"the message permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The message</h2>\n<p>As variants of malware of this kind are based on the simple fact that a victim cares more about his content than about paying a ransom, the authors usually leave a very detailed message for everyone to see.  The decryption key is stored on a remote server, but the attackers were “kind enough” to allow the victim to decrypt two files free, as a sign of authenticity.  The other function that exists on the attacked website allows the victim to communicate with the attacker via chat: it requires a personal signature/code which is available for victims only.</p>\n<h2 id=\"encryption\" style=\"position:relative;\"><a href=\"#encryption\" aria-label=\"encryption permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Encryption</h2>\n<p>I still don’t know how the CTB-Locker is being deployed on web servers, but there is one common thing among many of the attacked servers – they use the WordPress platform as a content management tool.  Once the malware author is inside WordPress system, he is able to replace the main website file and execute the encryption routine. The main file is renamed and saved in an encrypted state.</p>\n<p><img src=\"https://2.bp.blogspot.com/-KeL8Xa2g9EI/VtXgdX9FmvI/AAAAAAAAQik/xAOvU-5ufuE/s1600/ctb_locker_en_4-768x313.png\" alt=\"\"></p>\n<p>In the main page of the CTB-Locker, attackers are using jQuery to query proxy servers and verify payments. The following code was found in the page source code and the servers listed on the top are proxies which are used as another layer of protection, instead of the main server of the attackers:</p>\n<p><img src=\"https://1.bp.blogspot.com/-S3P0-rrNufE/VtXgnUhUZXI/AAAAAAAAQis/58zLPLPHQjQ/s1600/ctb_locker_en_5-768x568.png\" alt=\"\"></p>\n<p>Proxy servers which are part of the decryption process:</p>\n<ul>\n<li><a href=\"http://erdeni.ru/access.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://erdeni.ru/access.php</a></li>\n<li><a href=\"http://studiogreystar.com/access.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://studiogreystar.com/access.php</a></li>\n<li><a href=\"http://a1hose.com/access.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://a1hose.com/access.php</a></li>\n</ul>\n<h2 id=\"proxy-to-cc\" style=\"position:relative;\"><a href=\"#proxy-to-cc\" aria-label=\"proxy to cc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proxy to C&#x26;C</h2>\n<p>The attackers are utilizing servers which were already attacked to traffic through another layer of protection. On a victim server’s source code, a JavaScript code reveals how the decryption process is sent through three different servers randomly, however those are not the C&#x26;C</p>\n<p><img src=\"https://2.bp.blogspot.com/-4cIUzg45kiw/VtXhNdhRtQI/AAAAAAAAQi0/3JZi_4Pb1kM/s1600/ctb_locker_en_9.png\" alt=\"\"></p>\n<p>When POST request is being sent with the right parameters, a socket instance is being created and sends a connect beam to the attacker’s C&#x26;C server. Later it is being determined if the decryption process succeeded.</p>\n<h2 id=\"free-decrypt\" style=\"position:relative;\"><a href=\"#free-decrypt\" aria-label=\"free decrypt permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Free decrypt</h2>\n<p>The ransomware allows the victim to freely decrypt not more than two files. It is not for the victim to choose, since the files are pre-chosen and can be found in the malware’s designated file as listed above. The two files are randomly picked during the course of the encryption process.</p>\n<p><img src=\"https://2.bp.blogspot.com/-WnJW97tIi9o/VtXhlHay7nI/AAAAAAAAQjA/O87ECLotvsQ/s1600/ctb_locker_en_6.png\" alt=\"\"></p>\n<h2 id=\"threat-actors-chat-room\" style=\"position:relative;\"><a href=\"#threat-actors-chat-room\" aria-label=\"threat actors chat room permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Threat actor’s chat room</h2>\n<p>The ransomware also includes functionality to communicate with the malware authors. As already said, the victim is required to use the secret_ key in order to open the chat. Without it, the chat will remain unresponsive.</p>\n<p><img src=\"https://3.bp.blogspot.com/-aXi6sGBiuwM/VtXh77RoDRI/AAAAAAAAQjM/JPrASyN5tvc/s1600/ctb_locker_en_8.png\" alt=\"\"></p>\n<ul>\n<li><a href=\"http://whatis.techtarget.com/definition/command-and-control-server-CC-server\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">command-and-control server (C&#x26;C server)</a></li>\n<li><a href=\"http://securitydaily.net/ma-doc-tong-tien-ctb-locker-phat-tan-manh-me-lay-nhiem-hang-tram-ngan-may-chu-web/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Mã độc tống tiền CTB-Locker phát tán mạnh mẽ, lây nhiễm hàng trăm ngàn máy chủ web</a></li>\n<li><a href=\"https://securelist.com/blog/research/73989/ctb-locker-is-back-the-web-server-edition/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CTB-Locker is back: the web server edition</a></li>\n</ul>","fields":{"slug":"/2016/03/ctb-locker-is-back-web-server-edition.html","tagSlugs":["/tag/security/","/tag/tor/","/tag/ctb/","/tag/ransomware/"]},"frontmatter":{"date":"2016-03-02T01:42:00.000+07:00","description":"Cryptolockers have become more and more sophisticated, bypassing system protections and terrifying anyone in their path. TeslaCrypt, CryptoWall, TorrentLocker, Locky and CTB-Locker are only some of the malware we have protected from for the past two years. We have seen many shapes and colors of cryptolockers, but the new CTB-Locker variant says it all. The world of cybercriminals is investing in how to reinvent cryptolockers.","tags":["Security","Tor","CTB","Ransomware"],"title":"CTB-Locker is back: the web server edition","fbCommentUrl":"none"}}},"pageContext":{"slug":"/2016/03/ctb-locker-is-back-web-server-edition.html"}},"staticQueryHashes":["251939775","2672868365","401334301"]}