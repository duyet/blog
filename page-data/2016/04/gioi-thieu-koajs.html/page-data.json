{"componentChunkName":"component---src-templates-post-template-tsx","path":"/2016/04/gioi-thieu-koajs.html","result":{"data":{"markdownRemark":{"id":"fa00c9c7-fea0-5acc-a410-e45b3ef7f385","html":"<p>Về Node.js, ắt hẳn mọi người đều đã quá quen với Expressjs. Nên nay tôi giới thiệu một framework mới cũng khá hay, hiệu năng cao và dễ sử dụng - <a href=\"http://koajs.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Koajs - next generation web framework for node.js</a></p>\n<p><a href=\"https://blog.duyet.net/2016/04/gioi-thieu-koajs.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"https://4.bp.blogspot.com/-sCicwYtVpcY/VyS-dwEy4YI/AAAAAAAAUBM/5Q1QZ6zVR5YcsV7lgN8MYWfkZvrz6AXtgCK4B/s1600/Screen-Shot-2014-04-11-at-7.49.09-AM.png\" alt=\"\"></a></p>\n<h2 id=\"koajs-là-gì\" style=\"position:relative;\"><a href=\"#koajs-l%C3%A0-g%C3%AC\" aria-label=\"koajs là gì permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Koa.js là gì?</h2>\n<p>Koa là một Web framework Nodejs, được viết bởi team của Expressjs. Koa sử dụng nhiều chức năng mới của ES6, được xem là chưa ổn định với các bản Nodejs dưới 4.0, nhưng mới vừa rồi <a href=\"https://blog.duyet.net/2016/04/ra-mat-nodejs-v6.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Node v6 vừa ra mắt</a>, đánh dấu Koajs sẽ là 1 framework mạnh và ổn định hơn.</p>\n<p>Koa.js yêu cầu sử dụng Node.js v4.0 trở lên, với các bản 4.0 trở về trước yêu cầu sử dụng thêm flag —harmony để kích hoạt các chức năng mở rộng của Javascript (cụ thể là generator).</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">node --harmony app.js</code></pre></div>\n<h2 id=\"vì-sao-nên-sử-dụng-koa\" style=\"position:relative;\"><a href=\"#v%C3%AC-sao-n%C3%AAn-s%E1%BB%AD-d%E1%BB%A5ng-koa\" aria-label=\"vì sao nên sử dụng koa permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vì sao nên sử dụng Koa</h2>\n<p>Như đã PR, koa is next generation web framework. <a href=\"http://koajs.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Koa</a> chủ yếu tận dụng chức năng generators của Javascript ES6.\nBạn có thể xem bài viết sau để hiểu rõ hơn về Generators này: <a href=\"https://blog.duyet.net/2016/02/generator-function-javascript.html#.VyTAS4N94_M\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">function* và yield trong Javascript generator function</a></p>\n<p>Ngoài ra còn 2 chức năng mới nữa là sử dụng middleware theo từng tầng và xử lý lỗi tốt. Một điểm tôi thấy hay khi sử dụng nữa là Koa có phong cách code rất lite, giúp app nhỏ gọn và dễ kiểm soát.</p>\n<h2 id=\"hello-world\" style=\"position:relative;\"><a href=\"#hello-world\" aria-label=\"hello world permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hello world</h2>\n<p>Cài đặt koa bằng npm</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ npm install koa</code></pre></div>\n<p>Tạo và mở file <code class=\"language-text\">app.js</code> với nội dung:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var koa = require('koa');\nvar app = koa();\n\napp.use(function *(){\n  this.body = 'Hello World';\n});\n\napp.listen(3000);</code></pre></div>\n<p>Khởi động Web server bằng lệnh:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ node app.js</code></pre></div>\n<p>Truy cập trình duyệt bằng địa chỉ: <a href=\"http://localhost:3000/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:3000</a></p>\n<h2 id=\"yielding-to-\" style=\"position:relative;\"><a href=\"#yielding-to-\" aria-label=\"yielding to  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>yielding to *</h2>\n<p>Koa được viết dựa trên co - giúp xử lý generators, thay vì sử dụng callback, Koa nhờ đó có cú pháp đơn giản và sạch sẽ hơn.\nBạn nên đọc thêm về generators và co-routines ở bài viết này: <a href=\"https://medium.com/code-adventures/174f1fe66127\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://medium.com/code-adventures/174f1fe66127</a></p>\n<p>Tôi sẽ ví dụ nhanh, với Express từ trước đến giờ, mỗi khi cần truy suất vào database thì chỉ có mỗi cách gọi callback như sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function(req, res) {\n  db.getUser(function(err, u) {\n    if (err) return res.status(404).send(err);\n    res.send(u)\n  });\n}</code></pre></div>\n<p>Chưa kể là còn gặp phải trường hợp <a href=\"https://strongloop.com/strongblog/node-js-callback-hell-promises-generators/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Callback hell</a>, nhiều callback lồng vào nhau và đợi lẫn nhau.\nVới Koa:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function *(next) {\n  var user = yield db.getUser();\n  this.body = user;\n}</code></pre></div>\n<p>Koa có thể điều khiển luồng dữ liệu 1 cách trực quan nhất, cái bạn thấy đầu tiên là không cần sử dụng callback. Koa còn tương thích nhiều với các package co-*, cách tiếp cận khác khi làm việc với xử lý bất đồng bộ trong Nodejs. Tôi sẽ nó sâu hơn về co trong một dịp khác.</p>\n<h2 id=\"cascading-middleware\" style=\"position:relative;\"><a href=\"#cascading-middleware\" aria-label=\"cascading middleware permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cascading Middleware</h2>\n<p>Nếu bạn đã sử dụng qua Promises hay các framework control flow khác, mọi xử lý chỉ sẽ đi theo 1 luồng duy nhất, hoặc theo cơ chế ném-bắt callback. Koa middleware lại có cách xử lý hoàn toàn khác và mạnh mẽ hơn.</p>\n<p>Theo ghi ở trang chủ, thì koa: yields “downstream”, then control flows back “upstream”.</p>\n<p>Để giải thích, hay xem qua ví dụ về Koa logging sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app.use(function *(next){\n  var start = new Date;\n  yield next;  // &lt;--- yields \"downstream\" \n  var ms = new Date - start;\n  console.log('%s %s - %s', this.method, this.url, ms);\n});</code></pre></div>\n<p>Biến start sẽ lưu lại thời điểm bắt đầu, sau đó ứng dụng sẽ yields “downstream” đến router và các controller cần xử lý cho đến khi kết thúc. Control sẽ quay back lại hàm (middleware) này, tính thời gian thực thi và log ra màn hình.</p>\n<p>Một ví dụ khác khi xử lý kết quả trả về được xử lý ở nhiều nơi khác nhau. Với Express có thể phức tạp hơn nhiều, và phải kết hợp với template engine (như handlebars, …)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app.use(function *() {\n  this.body = \"...header stuff\";\n  yield saveResults();\n  //could do some other yield here \n  this.body += \"...footer stuff\"\n});\n\nfunction saveResults*() {\n  //save some results\n  this.body += \"Results Saved!\";\n  //could do some other yield here\n}</code></pre></div>\n<p>Tìm hiểu đầy đủ về middleware Koa tại đây: <a href=\"https://github.com/koajs/koa/blob/master/docs/guide.md\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/koajs/koa/blob/master/docs/guide.md</a></p>\n<h2 id=\"koa-lightweight\" style=\"position:relative;\"><a href=\"#koa-lightweight\" aria-label=\"koa lightweight permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Koa lightweight</h2>\n<p>Khác với Express với hàng tá các middleware được cài đặt sẵn. Định hướng là 1 framework core tinh gọn, Koa không có bất kì middleware được tích hợp sẵn cả.</p>\n<p>Có nhiều chức năng mà bạn sẽ cần phải cài thêm khi sử dụng koa tùy theo nhu cầu: routing, body parsing, basic authentication, static file serving, template rendering, … Danh sách các middleware được liệt kê ở wiki: <a href=\"https://github.com/koajs/koa/wiki\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/koajs/koa/wiki</a></p>\n<p>Một số middleware nổi bật nên cài như:</p>\n<ul>\n<li><a href=\"https://github.com/koajs/route\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">koa-static</a></li>\n<li><a href=\"https://github.com/alexmingoia/koa-router\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">koa-router</a></li>\n<li><a href=\"https://github.com/thomseddon/koa-body-parser\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">koa-body-parser</a></li>\n<li><a href=\"https://github.com/visionmedia/co-views\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">co-views</a></li>\n<li><a href=\"https://github.com/leukhin/co-request\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">co-request</a></li>\n<li><a href=\"https://github.com/rkusa/koa-passport\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">koa-passport</a></li>\n<li><a href=\"https://github.com/koajs/session\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">koa-session</a></li>\n<li>…</li>\n</ul>\n<h2 id=\"next\" style=\"position:relative;\"><a href=\"#next\" aria-label=\"next permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next</h2>\n<p>Koa tinh gọn, nên một số framework khác được build sẵn, bổ sung các chức năng mà koa đang thiếu:</p>\n<ul>\n<li><a href=\"https://github.com/koajs/api-boilerplate\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">api-boilerplate</a> - an API application boilerplate</li>\n<li><a href=\"https://github.com/base-n/koa-generator\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">koa-generator</a> - Koa’ application generator just like express-generator(support 1.x &#x26;&#x26; 2.x)</li>\n<li><a href=\"https://github.com/koajs/koala\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">koala</a> - a more feature-rich version of Koa (tích hợp sẵn nhiều middlewares có ích)</li>\n<li><a href=\"https://github.com/soygul/koan\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">koan</a> - Full stack JavaScript Web development boilerplate with Koa and Angular</li>\n<li><a href=\"https://github.com/zedgu/surface\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">surface</a> - A tiny middleware of RESTful API for koa</li>\n<li>…</li>\n</ul>\n<p>Với những bạn mới, tôi khuyên nên bắt đầu trước với koala hoặc koan.</p>\n<h2 id=\"tham-khảo\" style=\"position:relative;\"><a href=\"#tham-kh%E1%BA%A3o\" aria-label=\"tham khảo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tham khảo</h2>\n<ul>\n<li>Trang chủ - <a href=\"http://koajs.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://koajs.com</a></li>\n<li>Koa github - <a href=\"https://github.com/koajs/koa\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/koajs/koa</a></li>\n<li><a href=\"http://koajs.in/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Koajs.in</a> - A complete, easy to view Koa documentation</li>\n<li><a href=\"https://medium.com/@tjholowaychuk/callbacks-vs-coroutines-174f1fe66127#.w70iawu11\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">A look at callbacks vs generators vs coroutines</a></li>\n<li><a href=\"https://strongloop.com/strongblog/node-js-express-introduction-koa-js-zone/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Beyond Node.js Express: An Intro to Koa.js and a Preview of Zones</a></li>\n</ul>","fields":{"slug":"/2016/04/gioi-thieu-koajs.html","tagSlugs":["/tag/koa/","/tag/intro-js/","/tag/koajs/","/tag/node-js/","/tag/express-js/","/tag/node/"]},"frontmatter":{"date":"2016-04-30T22:29:00.003+07:00","description":"Về Node.js, ắt hẳn mọi người đều đã quá quen với Expressjs. Nên nay tôi giới thiệu một framework mới cũng khá hay, hiệu năng cao và dễ sử dụng KoaJs","tags":["koa","intro-js","koajs","Node.js","Express.js","Node"],"title":"Giới thiệu Koa.js","fbCommentUrl":"none"}}},"pageContext":{"slug":"/2016/04/gioi-thieu-koajs.html"}},"staticQueryHashes":["251939775","2672868365","401334301"]}