{"componentChunkName":"component---src-templates-post-template-js","path":"/2019/04/shorten-url-voi-firebase.html","result":{"data":{"markdownRemark":{"id":"6f96754b-504e-51e3-9b21-751dd57142a8","html":"<p><a href=\"https://www.searchenginejournal.com/goo-gl/246569/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">goo.gl đã shutdown</a>, và được thay thế bằng <a href=\"https://firebase.google.com/docs/dynamic-links\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Dynamic Link</a> của Firebase. Mình đã sử dụng API của Dynamic Link và Firebase viết <a href=\"https://s.duyet.net/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ứng dụng Shorten URL</a> mới siêu đơn giản như dưới đây. Bài viết này mình xin hướng dẫn một chút và chia sẽ mã nguồn, cũng như cách deploy siêu đơn giản của Google Firebase.  </p>\n<p><strong>Demo: <a href=\"https://s.duyet.net/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://s.duyet.net</a></strong>  </p>\n<p><a href=\"https://1.bp.blogspot.com/-mOYlbR85Tpw/XMciLyM34pI/AAAAAAAA_bE/aJtpyjh8Us0E5pbp8y6Djz4XA_qHmGFIACLcBGAs/s1600/Screen%2BShot%2B2019-04-29%2Bat%2B11.11.23%2BPM.png\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"https://1.bp.blogspot.com/-mOYlbR85Tpw/XMciLyM34pI/AAAAAAAA_bE/aJtpyjh8Us0E5pbp8y6Djz4XA_qHmGFIACLcBGAs/s1600/Screen%2BShot%2B2019-04-29%2Bat%2B11.11.23%2BPM.png\"></a></p>\n<p>Mã nguồn: <a href=\"https://github.com/duyetdev/firebase-shorten-url\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/duyetdev/firebase-shorten-url</a><br>\nService sử dụng:  </p>\n<ul>\n<li>Firebase Functions</li>\n<li>Firebase Hosting</li>\n<li>Dynamic Link</li>\n</ul>\n<h2 id=\"bước-1-cài-đặt-firebase-functions\" style=\"position:relative;\"><a href=\"#b%C6%B0%E1%BB%9Bc-1-c%C3%A0i-%C4%91%E1%BA%B7t-firebase-functions\" aria-label=\"bước 1 cài đặt firebase functions permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bước 1: Cài đặt Firebase Functions </h2>\n<p>theo các bước ở đây: <a href=\"https://firebase.google.com/docs/functions/get-started\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://firebase.google.com/docs/functions/get-started</a> bao gồm  </p>\n<ul>\n<li>Set up Node.js and the Firebase CLI  </li>\n<li>Initialize Firebase SDK for Cloud Functions</li>\n<li>Kích hoạt Dynamic Link<br>\n<a href=\"https://3.bp.blogspot.com/-cCVwSlW79zE/XMckrgE5OiI/AAAAAAAA_bQ/thCrS7fDnHEtqKHGW_z9JeMPL3B48SdnQCLcBGAs/s1600/Screen%2BShot%2B2019-04-29%2Bat%2B11.19.25%2BPM.png\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"https://3.bp.blogspot.com/-cCVwSlW79zE/XMckrgE5OiI/AAAAAAAA_bQ/thCrS7fDnHEtqKHGW_z9JeMPL3B48SdnQCLcBGAs/s1600/Screen%2BShot%2B2019-04-29%2Bat%2B11.19.25%2BPM.png\"></a>  </li>\n<li>Mã nguồn cho API <code class=\"language-text\">addUrl</code>  </li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> axios <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'axios'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// The Cloud Functions for Firebase SDK to create Cloud Functions and setup triggers.</span>\n<span class=\"token keyword\">const</span> functions <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'firebase-functions'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// The Firebase Admin SDK to access the Firebase Realtime Database.</span>\n<span class=\"token keyword\">const</span> admin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'firebase-admin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> admin<span class=\"token punctuation\">.</span><span class=\"token function\">initializeApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> functions<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>config\n<span class=\"token keyword\">const</span> apiKey <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">API_KEY</span> <span class=\"token operator\">||</span> config<span class=\"token punctuation\">.</span>api_key <span class=\"token operator\">||</span> app<span class=\"token punctuation\">.</span>options_<span class=\"token punctuation\">.</span>apiKey\n<span class=\"token keyword\">const</span> firebaseDynamicLinkApi <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://firebasedynamiclinks.googleapis.com/v1/shortLinks?key=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>apiKey<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> domainUriPrefix <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span>domain_uri_prefix <span class=\"token operator\">||</span> <span class=\"token string\">'https://duyeturl.page.link'</span><span class=\"token punctuation\">;</span>\n\nexports<span class=\"token punctuation\">.</span>addUrl <span class=\"token operator\">=</span> functions<span class=\"token punctuation\">.</span>https<span class=\"token punctuation\">.</span><span class=\"token function\">onRequest</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> link <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>url <span class=\"token operator\">||</span> req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>url <span class=\"token operator\">||</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span>firebaseDynamicLinkApi<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            dynamicLinkInfo<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                domainUriPrefix<span class=\"token punctuation\">,</span>\n                link<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            suffix<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                option<span class=\"token operator\">:</span> <span class=\"token string\">'SHORT'</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>Deploy Firebase Functions:  </li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">firebase deploy --only functions</code></pre></div>\n<h2 id=\"bước-2-firebase-hosting-web-ui\" style=\"position:relative;\"><a href=\"#b%C6%B0%E1%BB%9Bc-2-firebase-hosting-web-ui\" aria-label=\"bước 2 firebase hosting web ui permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bước 2: Firebase Hosting, Web UI</h2>\n<p>Website mình sử dụng <a href=\"https://gatsbyjs.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Gatsby React</a>, mã nguồn tại thư mục hosting: <a href=\"https://github.com/duyetdev/firebase-shorten-url/tree/master/hosting\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/duyetdev/firebase-shorten-url/tree/master/hosting</a>  </p>\n<p>API và Redirect link, cấu hình trong <code class=\"language-text\">firebase.json</code>, chú ý dòng rewrites <code class=\"language-text\">/api/add</code> và <code class=\"language-text\">/r/**</code>  </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"functions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"predeploy\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"npm --prefix \\\"$RESOURCE_DIR\\\" run lint\"</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"source\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"functions\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"hosting\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"cleanUrls\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"trailingSlash\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"public\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hosting/public\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"ignore\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"firebase.json\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"**/.*\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"**/node_modules/**\"</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"rewrites\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token string\">\"source\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/api/add\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"function\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"addUrl\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> <span class=\"token string\">\"source\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/r/**\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"dynamicLinks\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"source\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"**\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"destination\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/index.html\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Để test local, mở 2 terminal để chạy firebase functions và Gatsby hosting:  </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">firebase serve\ncd hosting &amp;&amp; npm run develop</code></pre></div>\n<p>Để build và deploy hosting:  </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd hosting &amp;&amp; npm run build &amp;&amp; firebase deploy</code></pre></div>\n<p><a href=\"https://1.bp.blogspot.com/-JVpuNLRiG30/XMcpQ9rtPzI/AAAAAAAA_bc/dozCos8sL9cgJsH0Y97ntVPhxnkIVo59ACLcBGAs/s1600/Screen%2BShot%2B2019-04-29%2Bat%2B11.41.36%2BPM.png\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"https://1.bp.blogspot.com/-JVpuNLRiG30/XMcpQ9rtPzI/AAAAAAAA_bc/dozCos8sL9cgJsH0Y97ntVPhxnkIVo59ACLcBGAs/s1600/Screen%2BShot%2B2019-04-29%2Bat%2B11.41.36%2BPM.png\"></a></p>\n<p>Kết quả: <a href=\"https://s.duyet.net/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://s.duyet.net</a>  </p>\n<p><a href=\"https://1.bp.blogspot.com/-mOYlbR85Tpw/XMciLyM34pI/AAAAAAAA_bI/bZ3GGBH2QA0OLdC8HrwNl_nFF2TVMu8hQCEwYBhgL/s1600/Screen%2BShot%2B2019-04-29%2Bat%2B11.11.23%2BPM.png\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"https://1.bp.blogspot.com/-mOYlbR85Tpw/XMciLyM34pI/AAAAAAAA_bI/bZ3GGBH2QA0OLdC8HrwNl_nFF2TVMu8hQCEwYBhgL/s1600/Screen%2BShot%2B2019-04-29%2Bat%2B11.11.23%2BPM.png\"></a></p>\n<p>Hiện tại link được tạo bởi Dynamic Link không hiện trên Firebase Dashboard, và chưa thể custom được keyword như trên Firebase Dashboard.  </p>\n<h2 id=\"tham-khảo\" style=\"position:relative;\"><a href=\"#tham-kh%E1%BA%A3o\" aria-label=\"tham khảo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tham khảo</h2>\n<ol>\n<li><a href=\"https://s.duyet.net/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://s.duyet.net</a></li>\n<li><a href=\"https://firebase.google.com/docs/dynamic-links\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Firebase Dynamic Links</a></li>\n<li><a href=\"https://gatsbyjs.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://gatsbyjs.org</a></li>\n</ol>","fields":{"slug":"/2019/04/shorten-url-voi-firebase.html","tagSlugs":["/tag/dynamic-links/","/tag/firebase/","/tag/firebase-functions/","/tag/firebase-hosting/","/tag/side-project/"]},"frontmatter":{"date":"2019-04-19T12:00:03.766+07:00","description":"goo.gl đã shutdown, và được thay thế bằng Dynamic Link của Firebase. Mình đã sử dụng API của Dynamic Link và Firebase viết ứng dụng Shorten URL mới siêu đơn giản như dưới đây. Bài viết này mình xin hướng dẫn một chút và chia sẽ mã nguồn, cũng như cách deploy siêu đơn giản của Google Firebase.","tags":["Dynamic Links","Firebase","Firebase Functions","Firebase Hosting","Side Project"],"title":"Super Simple Shorten URL với Firebase Dynamic Links","fbCommentUrl":"none"}}},"pageContext":{"slug":"/2019/04/shorten-url-voi-firebase.html"}}}