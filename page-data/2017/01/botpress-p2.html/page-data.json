{"componentChunkName":"component---src-templates-post-template-tsx","path":"/2017/01/botpress-p2.html","result":{"data":{"markdownRemark":{"id":"19d6f833-ea79-50a8-a4d5-babe5c0eace1","html":"<p>Tiếp tục phần 2, phần trước <a href=\"https://blog.duyet.net/2017/01/botpress.html#.WIarsRJ97_g\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Chatbot với Botpress</a> bạn đã có 1 bộ khung cho Bot chỉ với vài thao tác, <a href=\"https://blog.duyet.net/2017/01/botpress.html#KtniviMessenger\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">kết nối mới Messenger</a> với Persistent Menu, Getting Started message, làm quen với postback, Auto response, … module botpress-analytics để thống kê.</p>\n<p>Về cơ bản Bot theo cơ chế lắng nghe lệnh (từ khóa) và trả lời. Sau mình sẽ ví dụ đơn giản về cách lập trình cho Bot, làm Bot thông minh hơn khi kết hợp với 1 số service API trí tuệ nhân tạo (Wit.ai, Api.ai, …)</p>\n<p><img src=\"https://3.bp.blogspot.com/-GXx1lZwBtgg/WIbK6HLTO8I/AAAAAAAAimw/B9qbrjjIQIMC2CxXk1O-xqYAbTMOe4rogCLcB/s1600/screenshot-ui.png\"></p>\n<p>Xem lại phần 1: <a href=\"https://blog.duyet.net/2017/01/botpress.html#.WJP5QxJ97_g\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Chatbot với Botpress - Phần 1: Init Chatbot</a></p>\n<h2 id=\"simple-hello-world\" style=\"position:relative;\"><a href=\"#simple-hello-world\" aria-label=\"simple hello world permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Simple Hello World</h2>\n<p>OK để bắt đầu ta mở <code class=\"language-text\">index.js</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">bp</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  bp<span class=\"token punctuation\">.</span>middlewares<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Dòng 1: <code class=\"language-text\">bp</code> là biến global context object, từ <code class=\"language-text\">bp</code> ta có thể truy cập đến mọi chức năng của botpress và module api.\nDòng 2: Botpress sử dụng cơ chế middlewares để xử lý incoming và outcoming tin nhắn (hoặc tương tác).  Bạn có thể xem thêm về trang middleware <a href=\"https://docs.botpress.io/middlewares.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tại đây</a>.</p>\n<p>Bây giờ chúng ta thêm vào <code class=\"language-text\">index.js</code> như sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">bp</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  bp<span class=\"token punctuation\">.</span>middlewares<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  bp<span class=\"token punctuation\">.</span><span class=\"token function\">hear</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello ku'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// Capture 'hello ku'</span>\n   bp<span class=\"token punctuation\">.</span>messenger<span class=\"token punctuation\">.</span><span class=\"token function\">sendText</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token string\">'Hello world!'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Response</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Khởi động lại Botpress server.\nỞ đây mình hardcoded, Bot sẽ lắng nghe chuỗi “hello ku” và trả lời “Hello world!“. Đây chỉ là ví dụ cơ bản thôi, <a href=\"https://docs.botpress.io/core-reference.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">hear</a> middleware thực sự rất hữu ích.</p>\n<p><a href=\"https://1.bp.blogspot.com/--v33owHOC6Y/WIa2ZvmliqI/AAAAAAAAik4/EmA8Lc7XAgMAHGUHanOBtLs3uixdIlN1ACKgB/s1600/Screenshot_2017-01-24-09-03-08-630_com.facebook.orca.png\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"https://1.bp.blogspot.com/--v33owHOC6Y/WIa2ZvmliqI/AAAAAAAAik4/EmA8Lc7XAgMAHGUHanOBtLs3uixdIlN1ACKgB/s640/Screenshot_2017-01-24-09-03-08-630_com.facebook.orca.png\"></a></p>\n<h2 id=\"hello-world-nhưng-bớt-ngu-hơn-xíu\" style=\"position:relative;\"><a href=\"#hello-world-nh%C6%B0ng-b%E1%BB%9Bt-ngu-h%C6%A1n-x%C3%ADu\" aria-label=\"hello world nhưng bớt ngu hơn xíu permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hello world nhưng bớt ngu hơn xíu</h2>\n<p>Bây giờ mình muốn mỗi khi bot nghe “hello” là tự động chào lại bằng tên (first_name) mình.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">bp</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  bp<span class=\"token punctuation\">.</span>middlewares<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  bp<span class=\"token punctuation\">.</span><span class=\"token function\">hear</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">hello</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">i</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// We use a regex instead of a hardcoded string</span>\n    <span class=\"token keyword\">const</span> first_name <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>first_name\n\n    bp<span class=\"token punctuation\">.</span>messenger<span class=\"token punctuation\">.</span><span class=\"token function\">sendText</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token string\">'Hello, '</span> <span class=\"token operator\">+</span> first_name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> typing<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Ở lệnh <code class=\"language-text\">hear</code>, mình không dùng hardcoded string nữa mà sử dụng regex.  Bất kì tin nhắn nào chứa “hello” thì callback sẽ được gọi.</li>\n<li>Object <code class=\"language-text\">event.user</code> sẽ chứa mọi thông tin của user, mình sử dụng nó để reply lại chính tên người dùng. </li>\n<li>Tham số thứ 3 của hàm <code class=\"language-text\">sendText</code>, ta dùng <code class=\"language-text\">{ typing: true }</code> messenger sẽ hiển thị hiệu ứng đang typing, nhìn sẽ thật hơn.</li>\n</ul>\n<p><a href=\"https://4.bp.blogspot.com/-8vdkgAPplng/WIa4MtxfARI/AAAAAAAAilM/Ux0PKCpmXHoBui9hYc7fuO6busO4iJIaQCKgB/s1600/Screenshot_2017-01-24-09-12-24-681_com.google.android.apps.photos.png\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"https://4.bp.blogspot.com/-8vdkgAPplng/WIa4MtxfARI/AAAAAAAAilM/Ux0PKCpmXHoBui9hYc7fuO6busO4iJIaQCKgB/s640/Screenshot_2017-01-24-09-12-24-681_com.google.android.apps.photos.png\"></a></p>\n<h2 id=\"messenger-quick-reply\" style=\"position:relative;\"><a href=\"#messenger-quick-reply\" aria-label=\"messenger quick reply permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Messenger Quick Reply</h2>\n<p>Quick Reply là chức năng trong Messenger, cho phép user thay vì phải chat thì có thể chọn 1 từ menu. Khai báo tham số quick_replies như sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">bp</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    bp<span class=\"token punctuation\">.</span>middlewares<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    bp<span class=\"token punctuation\">.</span><span class=\"token function\">hear</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">hello</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">i</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// We use a regex instead of a hardcoded string</span>\n        <span class=\"token keyword\">const</span> first_name <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>first_name\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'=========='</span><span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span>\n\n        bp<span class=\"token punctuation\">.</span>messenger<span class=\"token punctuation\">.</span><span class=\"token function\">sendText</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token string\">'Hello, '</span> <span class=\"token operator\">+</span> first_name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> typing<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    bp<span class=\"token punctuation\">.</span><span class=\"token function\">hear</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">help</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">i</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n            quick_replies<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n                content_type<span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>\n                title<span class=\"token operator\">:</span> <span class=\"token string\">\"Đẹp\"</span><span class=\"token punctuation\">,</span>\n                payload<span class=\"token operator\">:</span> <span class=\"token string\">\"HELP_OPTION_1\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n                content_type<span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>\n                title<span class=\"token operator\">:</span> <span class=\"token string\">\"Rất đẹp\"</span><span class=\"token punctuation\">,</span>\n                payload<span class=\"token operator\">:</span> <span class=\"token string\">\"HELP_OPTION_2\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            typing<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            waitRead<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token comment\">// `waitDelivery` or `waitRead` options</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">const</span> text <span class=\"token operator\">=</span> <span class=\"token string\">'Duyệt có đẹp trai không?'</span>\n        bp<span class=\"token punctuation\">.</span>messenger<span class=\"token punctuation\">.</span><span class=\"token function\">sendText</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// Do `waitRead` nên nội dung trong đây sẽ được thực thi khi user read. </span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://1.bp.blogspot.com/-W7vlccclv-A/WIa9BT5alwI/AAAAAAAAil0/cGrnqfmlv_U-n2xJhOzgcZiZ9u9Oa0qDACKgB/s1600/Screenshot_2017-01-24-09-32-42-123_com.facebook.orca.png\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"https://1.bp.blogspot.com/-W7vlccclv-A/WIa9BT5alwI/AAAAAAAAil0/cGrnqfmlv_U-n2xJhOzgcZiZ9u9Oa0qDACKgB/s640/Screenshot_2017-01-24-09-32-42-123_com.facebook.orca.png\"></a></p>\n<h2 id=\"messenger-attachments\" style=\"position:relative;\"><a href=\"#messenger-attachments\" aria-label=\"messenger attachments permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Messenger Attachments</h2>\n<p>Messenger có thể gửi đính kèm với 4 định dạng: <code class=\"language-text\">&#39;audio&#39;</code>, <code class=\"language-text\">&#39;file&#39;</code>, <code class=\"language-text\">&#39;image&#39;</code> or <code class=\"language-text\">&#39;video&#39;</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">bp</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    bp<span class=\"token punctuation\">.</span>middlewares<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    bp<span class=\"token punctuation\">.</span><span class=\"token function\">hear</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">meo</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">i</span></span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> type <span class=\"token operator\">=</span> <span class=\"token string\">'image'</span> <span class=\"token comment\">// 'audio', 'file', 'image' or 'video'</span>\n        <span class=\"token keyword\">const</span> img_url <span class=\"token operator\">=</span> <span class=\"token string\">'https://avatars0.githubusercontent.com/u/5009534?v=3&amp;s=460'</span>\n        bp<span class=\"token punctuation\">.</span>messenger<span class=\"token punctuation\">.</span><span class=\"token function\">sendAttachment</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">,</span> img_url<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Tham số thứ 3 <code class=\"language-text\">url</code> của file đính kèm.</p>\n<p><a href=\"https://2.bp.blogspot.com/-cgMBrsS0v3E/WIa-rbq68cI/AAAAAAAAimE/0-05L5gKka8GI3qmJjjq20DrekMWIPjjwCKgB/s1600/Screenshot_2017-01-24-09-40-29-234_com.facebook.orca.png\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"https://2.bp.blogspot.com/-cgMBrsS0v3E/WIa-rbq68cI/AAAAAAAAimE/0-05L5gKka8GI3qmJjjq20DrekMWIPjjwCKgB/s640/Screenshot_2017-01-24-09-40-29-234_com.facebook.orca.png\"></a></p>\n<h2 id=\"messenger-templates\" style=\"position:relative;\"><a href=\"#messenger-templates\" aria-label=\"messenger templates permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Messenger Templates</h2>\n<p><a href=\"https://developers.facebook.com/docs/messenger-platform/send-api-reference/templates\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Facebook hỗ trợ nhiều dạng message template</a>. Ví dụ như:</p>\n<ol>\n<li><a href=\"https://developers.facebook.com/docs/messenger-platform/send-api-reference/button-template\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Button Template</a></li>\n<li><a href=\"https://developers.facebook.com/docs/messenger-platform/send-api-reference/generic-template\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Generic Template</a></li>\n<li><a href=\"https://developers.facebook.com/docs/messenger-platform/send-api-reference/list-template\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">List Template</a></li>\n<li><a href=\"https://developers.facebook.com/docs/messenger-platform/send-api-reference/receipt-template\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Receipt Template</a></li>\n<li><a href=\"https://developers.facebook.com/docs/messenger-platform/send-api-reference/airline-boardingpass-template\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Airline Bording Pass</a></li>\n<li><a href=\"https://developers.facebook.com/docs/messenger-platform/send-api-reference/airline-checkin-template\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Airline Checkin</a></li>\n<li><a href=\"https://developers.facebook.com/docs/messenger-platform/send-api-reference/airline-itinerary-template\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Airline Itinerary</a></li>\n<li><a href=\"https://developers.facebook.com/docs/messenger-platform/send-api-reference/airline-update-template\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Airline Flight Update</a></li>\n</ol>\n<p>Để sử dụng chúng ta chỉ cần khai báo đúng template như trong <a href=\"https://developers.facebook.com/docs/messenger-platform/send-api-reference/templates\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">docs</a> của facebook. Ví dụ:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">bp<span class=\"token punctuation\">.</span><span class=\"token function\">hear</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">duyetdev</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">i</span></span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> payload <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        template_type<span class=\"token operator\">:</span> <span class=\"token string\">\"button\"</span><span class=\"token punctuation\">,</span>\n        text<span class=\"token operator\">:</span> <span class=\"token string\">\"duyetdev profile\"</span><span class=\"token punctuation\">,</span>\n        buttons<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n                type<span class=\"token operator\">:</span> <span class=\"token string\">\"web_url\"</span><span class=\"token punctuation\">,</span>\n                url<span class=\"token operator\">:</span> <span class=\"token string\">\"https://duyet.net\"</span><span class=\"token punctuation\">,</span>\n                title<span class=\"token operator\">:</span> <span class=\"token string\">\"duyet.net\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">{</span>\n                type<span class=\"token operator\">:</span> <span class=\"token string\">\"web_url\"</span><span class=\"token punctuation\">,</span>\n                url<span class=\"token operator\">:</span> <span class=\"token string\">\"https://duyet.net\"</span><span class=\"token punctuation\">,</span>\n                title<span class=\"token operator\">:</span> <span class=\"token string\">\"Profile\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">{</span>\n                type<span class=\"token operator\">:</span> <span class=\"token string\">\"web_url\"</span><span class=\"token punctuation\">,</span>\n                url<span class=\"token operator\">:</span> <span class=\"token string\">\"https://facebook.com/duyetdev\"</span><span class=\"token punctuation\">,</span>\n                title<span class=\"token operator\">:</span> <span class=\"token string\">\"Facebook\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n\n    bp<span class=\"token punctuation\">.</span>messenger<span class=\"token punctuation\">.</span><span class=\"token function\">sendTemplate</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> payload<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> typing<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><a href=\"https://4.bp.blogspot.com/-uw8VgTCx_n0/WIbDuJ6D-ZI/AAAAAAAAimg/gi7ug_nLreYFnbTCj5pPSxqr1ofyLvYfACK4B/s1600/Screenshot_2017-01-24-09-59-12-331_com.facebook.orca.png\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"https://4.bp.blogspot.com/-uw8VgTCx_n0/WIbDuJ6D-ZI/AAAAAAAAimg/gi7ug_nLreYFnbTCj5pPSxqr1ofyLvYfACK4B/s640/Screenshot_2017-01-24-09-59-12-331_com.facebook.orca.png\"></a></p>\n<h2 id=\"kết\" style=\"position:relative;\"><a href=\"#k%E1%BA%BFt\" aria-label=\"kết permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kết</h2>\n<p>ChatBot không chỉ phải biết trả lời theo từ khóa mà còn phải hiểu được ý người chat khi viết bằng nhiều cách khác nhau, phần tiếp theo chúng ta sẽ làm cho con ahihi “thông minh” hơn bằng cách kết hợp với các Service API NLP để get được context, object, … từ tin nhắn của người dùng.</p>\n<p>Nếu có thời gian mình sẽ viết 1 bài tự build ra model cho Bot để có thể đọc hiểu và trả lời ở mức cơ bản.</p>\n<p>Xem phần 1: <a href=\"https://blog.duyet.net/2017/01/botpress.html#.WJP5QxJ97_g\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Chatbot với Botpress - Phần 1: Init Chatbot</a></p>\n<h2 id=\"tham-khảo\" style=\"position:relative;\"><a href=\"#tham-kh%E1%BA%A3o\" aria-label=\"tham khảo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tham khảo</h2>\n<ol>\n<li><a href=\"https://blog.duyet.net/2017/01/botpress.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Nodejs - Chatbot với Botpress</a></li>\n<li><a href=\"https://docs.botpress.io/advanced-topics.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Botpress Advanted Topics</a></li>\n<li><a href=\"https://github.com/botpress/botpress-messenger\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Botpress Messenger</a></li>\n<li><a href=\"https://developers.facebook.com/docs/messenger-platform\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Messenger Platform - Facebook Developers</a>.</li>\n</ol>","fields":{"slug":"/2017/01/botpress-p2.html","tagSlugs":["/tag/chatbot/","/tag/javascript/","/tag/node-js/","/tag/node/"]},"frontmatter":{"date":"2017-01-24T10:14:00.003+07:00","description":"Chatbot với Botpress phần 2","tags":["Chatbot","javascript","Node.js","Node"],"title":"Chatbot với Botpress - Phần 2: Coding","fbCommentUrl":"none"}}},"pageContext":{"slug":"/2017/01/botpress-p2.html"}},"staticQueryHashes":["251939775","2672868365","401334301"]}